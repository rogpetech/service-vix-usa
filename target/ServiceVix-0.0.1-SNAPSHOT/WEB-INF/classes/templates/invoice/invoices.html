<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ServiceVix</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/dataTables.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/slimselect.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-icons.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
	<!--navbar-->

	<div class="body_container d-flex">
		<div th:replace="component/sidebar :: sidebar"></div>
		<div class="main">
			<!-- haeder -->
			<header th:replace="component/topmenu :: topmenu"></header>
			<!-- headerend -->
			<!-- mainconatiner -->
			<div class="container-fluid p-2 p-md-3 p-lg-4 scroll-conatiner">


				<div class="card data-cards">
					<div class="workforce-container">
						<nav>
							<div class="nav nav-tabs" id="nav-tab" role="tablist">
								<button class="nav-link active custom-navlink" id="nav-workforce-tab"
									data-bs-toggle="tab" data-bs-target="#nav-workforce" type="button" role="tab"
									aria-controls="nav-workforce" aria-selected="true">
									Invoices
								</button>

							</div>
						</nav>
						<div th:if="${session.message != null}" id="popupMessage" class="mt-2">
							<div class="alert fade show"
								th:classappend="${session.message.type == 'success'} ? 'alert-success ' : 'alert-danger '"
								role="alert">
								<div th:if="${session.message.type == 'success'}">
									<strong><i class="bi bi-check-circle-fill me-2"></i>Hey! </strong><span
										th:text="${session.message.text}"></span>
								</div>
								<div th:unless="${session.message.type == 'success'}">
									<strong><i class="bi bi-x-circle-fill me-2"></i></i>Oops ! </strong><span
										th:text="${session.message.text}"></span>
								</div>
								<button type="button" class="btn-close" data-bs-dismiss="alert"
									aria-label="Close"></button>
							</div>
						</div>
						<div class="tab-content" id="nav-tabContent">
							<div class="tab-pane fade show active" id="nav-workforce" role="tabpanel"
								aria-labelledby="nav-workforce-tab">
								<div class="container-fluid custome-data-table mt-5">

									<table id="invoices-table"
										class="table mt-3 custom-table custom-list-table dt-responsive nowrap">
										<a class="primary-btn" href="/invoice/add" style="float: right;width: auto;">+
											Create Invoice</a>
										<thead>
											<tr>
												<th>#</th>
												<th>Invoice ID</th>
												<th>Estimate Id</th>
												<th>Customer</th>
												<!--<th>Sent</th>-->
												<th>Total</th>
												<th>Created on</th>
												<th>Action</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="invoice,iteration : ${invoices}">
												<td th:text="${(iteration.index+1)}"></td>
												<td th:text="${invoice.id}"></td>
												<!--<td th:if="${invoice.estimateDTO != null}" th:text="${invoice.estimateDTO.id}">-->
												<td th:if="${invoice.estimateDTO != null}">
													<a th:href="@{'/estimate/operation/view/'+${invoice.estimateDTO.id}}"
														th:text="${invoice.estimateDTO.id}">
													</a>
												</td>
												<td th:unless="${invoice.estimateDTO != null}">Not Available</td>
												<td th:text="${invoice.customerDTO.customerName}"></td>


												<!--<td><img src="/assest/send_invoice.png" alt=""></td>-->
												<td th:if="${invoice.options[0].invoiceTotal!=null}"
													th:text="'$'+${#numbers.formatDecimal(invoice.options[0].invoiceTotal, 0, 'COMMA', 2, 'POINT')}">
												</td>
												<td th:unless="${invoice.options[0].invoiceTotal!=null}"></td>
												<td
													th:text="${#strings.substring(invoice.createdAt, 0, 10)+' '+#strings.substring(invoice.createdAt, 11, 19)}">
												</td>
												<td>
													<span>
														<a type="button"
															th:href="@{'/invoice/view/'+${invoice.id}}"><button
																class="table-action-buttons view-btn me-2"><img
																	th:src="@{/assest/eye.svg}"
																	class="img-fluid view-icon" alt=""
																	th:id="${'invoice_id_'+invoice.id}"></button>
														</a>
													</span>
													<span>
														<a th:href="@{'/invoice/update/'+${invoice.id}}"><span>
																<button class="table-action-buttons me-2">
																	<img th:src="@{/assest/pencil.svg}"
																		class="img-fluid edit-icon" alt="icon">
																</button>
															</span>
														</a>
													</span>
													<span>
														<button class="table-action-buttons del-btn" type="button"
															data-bs-toggle="modal"
															th:data-bs-target="'#deleteConfirmationModal-' + ${iteration.index}">
															<img th:src="@{/assest/trash.svg}"
																class="img-fluid plan-carousel-btn" alt="">
														</button> <!-- Delete Confirmation Modal -->
														<div class="modal fade"
															th:id="'deleteConfirmationModal-' + ${iteration.index}"
															tabindex="-1" aria-labelledby="deleteConfirmationLabel"
															aria-hidden="true">
															<div class="modal-dialog modal-dialog-centered">
																<div class="modal-content">
																	<!-- Close button -->
																	<button type="button" class="btn-close"
																		data-bs-dismiss="modal"
																		aria-label="Close"></button>

																	<!-- Modal Body -->
																	<div class="modal-body">
																		<h4 class="modal-title"
																			id="deleteConfirmationLabel">Delete Invoice
																		</h4>
																		<p>Are you sure you want to delete this Invoice
																			?</p>
																	</div>

																	<!-- Modal Footer -->
																	<div class="modal-footer">
																		<!-- Cancel Button -->
																		<button type="button" class="btn btn-secondary"
																			data-bs-dismiss="modal">Cancel</button>
																		<!-- Delete Button (You can replace '#' with the URL/endpoint to handle the delete operation) -->
																		<a th:href="@{'/invoice/remove/' + ${invoice.id}}"
																			class="btn btn-danger">Delete</a>
																	</div>
																</div>
															</div>
														</div> <!-- Delete Confirmation Moda End -->
													</span>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>

		</div>
	</div>

	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/bootstrap-select.min.js}"></script>
	<script th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/js/responsive.bootstrap5.min.js}"></script>
	<script th:src="@{/js/dataTables.bootstrap5.min.js}"></script>
	<script th:src="@{/js/slimselect.js}"></script>
	<script th:src="@{/js/initializeDataTables.js}"></script>
	<script th:src="@{/js/main.js}"></script>
</body>

</html>