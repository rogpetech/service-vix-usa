<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ServiceVix</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/dataTables.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/slimselect.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-icons.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.css}">
	<link rel="stylesheet" th:href="@{/https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css}">


</head>

<body>

	<!--navbar-->
	<div class="body_container d-flex">
		<div th:replace="component/sidebar :: sidebar"></div>
		<div class="main">
			<!-- haeder -->
			<header th:replace="component/topmenu :: topmenu"></header>
			<!-- headerend -->
			<!-- mainconatiner -->
			<!--Remove Page Validation Modal -->
			<div class="modal fade" id="leaveModal" tabindex="-1" role="dialog" aria-labelledby="leaveModalLabel"
				aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="leaveModalLabel">Warning</h5>
						</div>
						<div class="modal-body">
							Are you sure you want to leave this page? You will lose your unsaved data.
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="button" class="btn btn-primary" id="leaveButton">Leave</button>
						</div>
					</div>
				</div>
			</div>
			<!-- Remove Page Validation Modal End -->
			<div id="add-estimate-parent-div" class="container-fluid  p-2 p-md-3 p-lg-4 scroll-conatiner">

				<!-- send_estimate_Modal -->
				<div class="modal fade" id="sendEstimateModal" tabindex="-1" aria-labelledby="sendEstimateModalLabel"
					aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered modal-xl">
						<div class="modal-content update-profile-modal">
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							<div class="modal-body">
								<div class="est-header d-flex">
									<h5 class="fw-bold">Email Estimate</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								<div class="row">
									<div class="col-md-6">
										<div class="send-estimate-container mt-4">
											<form class="row g-3" id="sendEmailEstimateForm"
												th:action="@{/estimate/send}" method="post">
												<div class="col-md-12">
													<div class="input-items">
														<label for="inputfrom" class="form-label">From:</label> <input
															th:if="${fromEmailAddress != null}" type="text"
															class="form-control" id="inputfrom"
															placeholder="johndoe@gmail.com"
															th:value="${fromEmailAddress}" name="fromEmail" readonly>
														<input th:unless="${fromEmailAddress != null}" type="text"
															class="form-control" id="inputfrom"
															placeholder="johndoe@gmail.com" name="fromEmail" readonly>
													</div>
												</div>
												<div class="col-md-12">
													<div class="input-items">
														<label for="inputTo" class="form-label">To:</label>
														<input type="text" class="form-control" id="inputTo"
															placeholder="johndoe@gmail.com"
															th:if="${estimate!= null and estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.emails) > 0}"
															th:value="${estimate.CustomerDTO.emails[0].email}"
															name="toEmail" readonly>
														<input type="text" class="form-control" id="inputTo"
															placeholder="johndoe@gmail.com"
															th:unless="${estimate!= null and estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.emails) > 0}"
															name="toEmail" readonly>
													</div>
												</div>
												<div class="col-md-12">
													<div class="input-items">
														<label for="inputsub" class="form-label">Subject:</label>
														<input type="text" class="form-control" id="inputsub"
															name="subject" placeholder="Interesting"
															th:if="${estimateEmailSubject != null}"
															th:value="${estimateEmailSubject}">
														<input type="text" class="form-control" id="inputsub"
															name="subject" placeholder="Interesting"
															th:unless="${estimateEmailSubject != null}">
													</div>
												</div>
												<hr class="dividing_line">
												<div class="col-md-12">
													<textarea type="text" class="form-control custom-area" name="body"
														th:if="${bodyContent != null}"
														th:text="${bodyContent}"></textarea>
													<textarea type="text" class="form-control custom-area" name="body"
														th:unless="${bodyContent != null}" th:text="${bodyContent}"
														id="inputBody"></textarea>
													<!--<input type="hidden" name="body" th:value="${bodyHtmlContent}"/>-->
												</div>
												<div class="col-md-12">
													<div class="attach_checkboxes">
														<p>Attach</p>
														<div class="row">
															<div class="col-md-3 input-items">
																<input type="checkbox" name="itemPrice"
																	id="optionPriceCheck"
																	onchange=updateEstimateHTMLView(event)>
																<label for="inpPrice" class="form-label">Item
																	Price</label>
															</div>
															<div class="col-md-3 input-items">
																<input type="checkbox" name="itemTotal"
																	id="optionTotalCheck"
																	onchange=updateEstimateHTMLView(event)>
																<label for="attach_total" class="form-label">Item
																	Total</label>
															</div>
															<div class="col-md-3 input-items">
																<input type="checkbox" name="itemQuantity"
																	id="optionQuantityCheck"
																	onchange=updateEstimateHTMLView(event)>
																<label for="attach_quan" class="form-label">Item
																	Quantity</label>
															</div>
															<div class="col-md-3 input-items">
																<input type="checkbox" name="grandTotal"
																	id="optionGrandTotalCheck"
																	onchange=updateEstimateHTMLView(event) checked>
																<label for="attachinp_total" class="form-label">Grand
																	Total</label>
															</div>
														</div>
													</div>
													<div class="attach_esti_dropdown"></div>
												</div>
												<div class="col-md-12">
													<div id="error" style="color: red; display: none;">Please check at
														least one
														option.</div>
													<p>Estimate Option</p>
													<div th:if="${ estimate.options != null}" class="d-inline">
														<div class="d-inline p-2" id="optionsdiv">
														</div>
													</div>
												</div>
												<input type="hidden" th:value="${estimate.id}" name="estimateId" />
												<button type="submit" id="estimateEmailSendBtn"
													class="primary-btn send-btn-estimate">Send</button>
											</form>
										</div>
									</div>
									<div class="col-md-6 scroll-conatiner">
										<!--Estimate PDF HTML View start-->
										<div id="invoiceholder" style="width: 100%;height: 100%;">
											<div id="invoice" class="effect2"
												style="position: relative;margin: 0 auto;background: #FFF;">
												<div id="invoice-top"
													style="padding: 20px;border-bottom: 2px solid #00a63f;">
													<div class="logo"
														style="display: inline-block;vertical-align: middle;overflow: hidden;">
														<img src="/assest/brandlogo.png" alt="Logo"
															style="width: 100%;" />
													</div>
													<div class="title" style="margin-top: -10px;float: right;">
														<h1 style="font-size: 1.5em;color: #444;">Estimate #<span
																class="invoiceVal invoice_num"
																id="estimateIdHTMLView"></span></h1>
														<p
															style="font-size: .75em;color: #666;line-height: 1.2em;text-align: right;">
															Estimate
															Date: <span id="estimateDateHTMLView"></span></p>
													</div>
													<!--End Title-->
												</div>
												<!--End InvoiceTop-->
												<div id="invoice-mid" style="padding: 20px;min-height: 110px;">
													<div id="message" style="margin-bottom: 30px;display: block;">
														<h2 style="font-size: .9em;margin-bottom: 5px;color: #444;">
															Hello <span id="estimateCustomerNameHTMLView"></span>,</h2>
														<p style="font-size: .75em;color: #666;line-height: 1.2em;">An
															estimate with ID number
															Estimate #<span id="estimateId2HTMLView"></span> is
															created and
															is waiting for your approval.</p>
														<!--<a href="javascript:void(0);">Click here</a> to login </p>-->
													</div>
													<div class="cta-group mobile-btn-group" style="display: none;">
														<a href="javascript:void(0);" class="btn-primary"
															style="text-decoration: none;color: #fff;display: inline-block;padding: 10px;border-radius: 4px;background: #00a63f;margin-right: 10px;min-width: 140px;text-align: center;font-size: 0.95em;">Accept</a>
														<a href="javascript:void(0);" class="btn-default"
															style="text-decoration: none;color: #fff;display: inline-block;padding: 10px;border-radius: 4px;background: rgb(128 114 110);margin-right: 10px;min-width: 140px;text-align: center;font-size: 0.95em;">Request
															change</a>
													</div>
													<div class="clearfix">
														<div class="col-left" style="float: left;">
															<div class="clientlogo"
																style="display: inline-block;vertical-align: middle;width: 50px;">
																<img src="https://cdn3.iconfinder.com/data/icons/daily-sales/512/Sale-card-address-512.png"
																	alt="Sup" style="width: 100%;" />
															</div>
															<div class="clientinfo"
																style="display: inline-block;vertical-align: middle;margin-left: 20px;">
																<h2 id="supplier"
																	style="font-size: .9em;margin-bottom: 5px;color: #444;">
																	TESI
																	S.P.A.</h2>
																<p
																	style="font-size: .75em;color: #666;line-height: 1.2em;">
																	<span id="address">VIA
																		SAVIGLIANO, 48</span><br></br><span
																		id="city">RORETO DI
																		CHERASCO</span><br></br><span
																		id="country">IT</span> - <span
																		id="zip">12062</span><br></br><span
																		id="tax_num">555-555-5555</span><br></br>
																</p>
															</div>
														</div>
														<div class="col-right" style="float: right;"></div>
													</div>
												</div>
												<!--End Invoice Mid-->
												<div id="estimateOptionsHTMLView"></div>
												<!--End InvoiceBot-->
												<footer style="border-top: 1px solid #eeeeee;padding: 15px 20px;">
													<div id="legalcopy" class="clearfix">
														<p class="col-right"
															style="font-size: .75em;color: #666;line-height: 1.2em;float: right;">
															Our
															mailing address is:
															<span class="email"><a
																	href="mailto:supplier.portal@almonature.com"
																	style="text-decoration: none;color: #00a63f;">info@servicevix.com</a></span>
														</p>
													</div>
												</footer>
											</div>
											<!--End Invoice-->
										</div>
										<!--Estimate PDF HTML View End-->
									</div>
								</div>
							</div>

						</div>
					</div>
				</div>
				<!-- send_estimate_Modal_end -->

				<!-- add_customer_modal-->
				<!-- add_customer_modal_end -->

				<!-- add_product_modal -->
				<div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductLabel"
					aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered modal-lg">
						<button type="button" class="btn-close" id="addProductPopupCloseBtn" data-bs-dismiss="modal"
							aria-label="Close"></button>
						<div class="modal-content update-profile-modal">
							<button type="button" class="btn-close" id="addProductPopupCloseBtn" data-bs-dismiss="modal"
								aria-label="Close"></button>
							<div class="modal-body">
								<div class="est-header d-flex">
									<h5 class="fw-bold">Add Product</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								<div class="send-estimate-container mt-4">
									<form class="row g-4" id="form_prodct"
										th:action="@{/product/process-popup-addProduct}" method="post"
										enctype="multipart/form-data">
										<p class="section-heading">Product Information</p>

										<div class="col-md-6">
											<div class="input_field">
												<label for="inpproduct" class="form-label">Product
													Name</label> <input type="text" class="form-control" id="inpproduct"
													name="productName"> <i class="fas fa-check-circle"></i> <i
													class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>
										<div class="col-md-6">
											<label for="select_product_cat" class="form-label">Product
												Category</label> <select class="selectpicker form-control"
												id="select_product_cat" name="productCategoryId">
												<option value="" selected="selected">Select one</option>
												<option th:each="productCat : ${productCategories}"
													th:value="${productCat.productCategoryId}"><span
														th:text="${productCat.productCategoryName}"></span>
												</option>
												<!-- <option value="2">2</option>
												<option value="3">3</option>
												<option value="4">4</option> -->

											</select>
										</div>
										<div class="col-md-6">
											<label for="inpwork" class="form-label">Description</label>
											<textarea class="form-control custom-area" id="inpwork" rows="3"
												name="discription"></textarea>
										</div>
										<div class="col-md-6 position-relative">
											<label class="form-label">Product Images</label>
											<div class="upload__box">
												<div class="upload__img-wrap"></div>
												<div class="upload__btn-box">
													<label class="upload__btn primary-btn">Upload
														images <input type="file" data-max_length="20"
															class="upload__inputfile" name="categoryImage"
															id="categoryImage" accept="image/*">
													</label>
												</div>
											</div>
										</div>

										<p class="mt-5 section-heading">Sales & Purchasing
											Details</p>

										<div class="col-md-6 col-xl-3">
											<div class="input_field">
												<label for="reg_price" class="form-label">Regular
													Price($)</label> <input type="text" class="form-control"
													id="reg_price" placeholder="0.00" name="regularPrice">
												<i class="fas fa-check-circle"></i> <i
													class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>
										<div class="col-md-6 col-xl-3">
											<div class="input_field">
												<label for="mem_price" class="form-label">Member
													Price($)</label> <input type="text" class="form-control"
													id="mem_price" placeholder="0.00"> <i
													class="fas fa-check-circle"></i> <i
													class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>
										<div class="col-md-6 col-xl-3">
											<div class="input_field">
												<label for="avg_cost" class="form-label">Average
													Cost($)</label> <input type="text" class="form-control"
													id="avg_cost" placeholder="0.00" name="averageCost">
												<i class="fas fa-check-circle"></i> <i
													class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>

										<div class="col-12">
											<div class="form-submit">
												<a class="secondary-btn form-btns me-3"
													data-bs-dismiss="modal">Cancel</a>
												<button type="button" onclick="addProductPopup()"
													class="primary-btn form-btns">Add
													Product</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- add_product_modal end-->

				<!-- add_service_modal-->
				<div class="modal fade" id="addServiceModal" tabindex="-1" aria-labelledby="addServiceLabel"
					aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered modal-lg">
						<div class="modal-content update-profile-modal">
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							<div class="modal-body">
								<div class="est-header d-flex">
									<h5 class="fw-bold">Add Service</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								<div class="send-estimate-container mt-4">

									<form method="post" th:action="@{/service/process-popup-addSerivce}"
										enctype="multipart/form-data" class="row g-4" id="form_service">
										<p class="section-heading">Service Information</p>
										<div class="col-md-6">
											<div class="input_field">
												<label for="inp_service_name" class="form-label">Service
													Name</label> <input type="text" class="form-control"
													id="inp_service_name" name="serviceName"> <i
													class="fas fa-check-circle"></i> <i
													class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>
										<div class="col-md-6">
											<label for="select_service_category" class="form-label">Service
												Category</label> <select class="selectpicker form-control"
												id="select_service_category" name="serviceCategoryId">
												<option selected="selected">Select one</option>
												<option th:each="serviceCat : ${serviceCategories}"
													th:value="${serviceCat.serviceCategoryId}"><span
														th:text="${serviceCat.serviceCategoryName}"></span>
												</option>
												<!-- <option value="1">Service 1</option>
                                                            <option value="1">Service 2</option>
                                                            <option value="1">Service 3</option>
                                                            <option value="1">Service 4</option> -->

											</select>
										</div>
										<div class="col-md-6">
											<label for="inp_ser_dec" class="form-label">Description</label>
											<textarea class="form-control custom-area" id="inp_ser_dec" rows="3"
												name="discription"></textarea>
										</div>
										<div class="col-md-6 position-relative">
											<label class="form-label">Service Images</label>
											<div class="upload__box">
												<div class="upload__img-wrap"></div>
												<div class="upload__btn-box">
													<label for="upload_service_pics"
														class="upload__btn primary-btn">Upload images <input type="file"
															multiple="" data-max_length="20" class="upload__inputfile"
															id="upload_service_pics" name="categoryImage"
															accept="image/*">
													</label>
												</div>
											</div>
										</div>

										<p class="mt-5 section-heading">Service Rates</p>

										<div class="col-md-6 col-xl-3">
											<div class="input_field">
												<label for="reg_rate" class="form-label">Regular
													Rate($)</label> <input type="text" class="form-control"
													id="reg_rate" name="regularPrice"> <i
													class="fas fa-check-circle"></i>
												<i class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>
										<div class="col-md-6 col-xl-3">
											<div class="input_field">
												<label for="mem_rate" class="form-label">Member
													Rate($)</label> <input type="text" class="form-control"
													id="mem_rate" name="internalCost"> <i
													class="fas fa-check-circle"></i>
												<i class="fas fa-exclamation-circle"></i> <small>Error
													message</small>
											</div>
										</div>

										<div class="col-12">
											<div class="form-submit">
												<a class="secondary-btn form-btns me-3" id="addServicePopupCloseBtn"
													data-bs-dismiss="modal">Cancel</a>
												<button type="button" onclick="addServicePopup()"
													class="primary-btn form-btns">Add
													Service</button>
											</div>
										</div>
									</form>
								</div>
							</div>

						</div>
					</div>
				</div>
				<!-- add_service_modal_end -->


				<div class="card data-cards ">
					<div class="add-satff-container p-2">
						<div class="data-cards-header d-flex justify-content-between estimate-header">
							<h4 th:if="${requestForView}">Edit Estimate</h4>
							<h4 th:unless="${requestForView}">Add Estimate</h4>
						</div>
						<div class="data-cards-body mt-4">
							<p class="section-heading">Genearal Information</p>
							<form class="row g-4" id="estimate-form" th:action="@{/estimate/process-update}"
								method="post">
								<input type="hidden" name="estimateId" th:value="${estimate.id}" />
								<div class="col-md-6 position-relative">
									<label for="customer_name" class="form-label">Customer
										name</label>
									<input class="form-control" type="text"
										th:value="${estimate.CustomerDTO.customerName}" name="customerName"
										id="customer_name_input" onKeyUp="searchCustomer(event)" autocomplete="off"
										readonly>
									<div id="customer_search_results" class="search-results"></div>
								</div>
								<ul id="search-customers"></ul>
								<div class="col-md-6 col-xl-3">
									<label class="form-label">Parent Account Name</label>
									<input class="form-control" id="paren_acc" name="customerParentAccount"
										th:if="${estimate.CustomerDTO != null}"
										th:readonly="${estimate.CustomerDTO != null and requestForView}"
										th:value="${estimate.CustomerDTO.customerParentAccount}" />
									<input th:unless="${estimate.CustomerDTO != null}" readonly type="text"
										class="form-control" id="paren_acc" name="customerParentAccount">
								</div>
								<div class="col-md-6 col-xl-3 me-5">
									<label for="multi-mobile" class="form-label">Mobile</label>
									<div class="multi-field-wrapper" id="multi_mobile_wrapper_estimate">
										<div class="multi-fields">
											<div class="multi-field mb-2">
												<div class="input_and_select">
													<div class="select">
														<select class="selectpicker form-control" id="multi-mobile"
															disabled name="sel[]">
															<option value="MOBILE"
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
																th:selected="${estimate.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'MOBILE'}">
																Mobile</option>
															<option
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
																selected="selected" value="MOBILE">Mobile</option>
															<option value="HOME"
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
																th:selected="${estimate.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'HOME'}">
																Home</option>
															<option value="HOME"
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}">
																Home</option>
															<option value="WORK"
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
																th:selected="${estimate.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'WORK'}">
																Work</option>
															<option value="WORK"
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}">
																Work</option>
															<option value="OTHER"
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
																th:selected="${estimate.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'OTHER'}">
																Other</option>
															<option value="OTHER"
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}">
																Other</option>
														</select>
													</div>
													<input
														th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
														th:value="${estimate.CustomerDTO.contactNumbers[0].number}"
														th:readonly="${requestForView}" id="estimate_mobileID"
														type="text" class="form-control " name="contactNumber">
													<input
														th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.contactNumbers) > 0}"
														id="estimate_mobileID" type="text" class="form-control "
														name="contactNumber" readonly>
												</div>
												<button type="button" class="remove-field ">
													<img th:src="@{/assest/cross.svg}" class="img-icon" alt="">
												</button>
											</div>
										</div>
									</div>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="multi-email" class="form-label">Email</label>
									<div class="multi-field-wrapper" id="multi_email_wrapper_estimate">
										<div class="multi-fields" id="multi-fields_email">
											<div class="multi-field mb-2" id="multi-field_email">
												<div class="input_and_select">
													<div class="select">
														<select class="selectpicker form-control"
															id="multi-email-estimate" name="estimate_email_multi_select"
															disabled>
															<option
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.emails) > 0}"
																th:selected="${estimate.CustomerDTO.emails[0].emailCategory.toString() == 'PERSONAL'}"
																value="PERSONAL">
																Personal</option>
															<option
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.emails) > 0}"
																selected="selected" value="PERSONAL">Personal</option>
															<option
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.emails) > 0}"
																th:selected="${estimate.CustomerDTO.emails[0].emailCategory.toString() == 'BUSINESS'}"
																value="BUSINESS">Business</option>
															<option
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.emails) > 0}"
																selected="BUSINESS" value="PERSONAL">Business</option>
															<option
																th:if="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.emails) > 0}"
																th:selected="${estimate.CustomerDTO.emails[0].emailCategory.toString() == 'OTHER'}"
																value="OTHER">Other</option>
															<option
																th:unless="${estimate.CustomerDTO != null and #lists.size(estimate.CustomerDTO.emails) > 0}"
																selected="OTHER" value="OTHER">Other</option>
														</select>
													</div>

													<input id="estimate_emailID" name="estimate_email_multi"
														th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.emails) > 0}"
														th:value="${estimate.CustomerDTO.emails[0].email}"
														th:readonly="${requestForView}" type="text"
														class="form-control">
													<input
														th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.emails) > 0}"
														id="estimate_emailID" type="text" class="form-control "
														name="contactNumber" readonly>
												</div>
												<button type="button" class="remove-field ">
													<img th:src="@{/assest/cross.svg}" class="img-icon" alt="">
												</button>
											</div>
										</div>
									</div>

								</div>
								<p class="mt-5 section-heading">Service location</p>
								<div class="col-md-6 col-xl-3">
									<label for="location_name" class="form-label">Location
										nickname</label>
									<input type="text" class="form-control" id="location_name"
										name="estimate_email_multi"
										th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${estimate.CustomerDTO.storedServiceLocations[0].locationNickName}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_location_name" readonly
										th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="apt_suite" class="form-label">Apt/suite/unit</label>
									<input type="text" class="form-control" id="es_apt_suite"
										th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${estimate.CustomerDTO.storedServiceLocations[0].unit}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_apt_suite" readonly
										th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6">
									<label for="loca_address" class="form-label">Address</label>
									<input type="text" class="form-control" id="es_loca_address"
										th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${estimate.CustomerDTO.storedServiceLocations[0].address}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_loca_address" readonly
										th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="locat_city" class="form-label">City</label>
									<input type="text" class="form-control" id="es_locat_city"
										th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${estimate.CustomerDTO.storedServiceLocations[0].city}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_locat_city" readonly
										th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="locat_state" class="form-label">State/Zip</label>
									<input type="text" class="form-control" id="es_locat_state"
										th:if="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${estimate.CustomerDTO.storedServiceLocations[0].state}"
										th:readonly="${requestForView}">
									<input
										th:unless="${estimate.CustomerDTO != null and requestForView and #lists.size(estimate.CustomerDTO.storedServiceLocations) > 0}"
										type="text" class="form-control" id="es_locat_state" readonly>
								</div>
								<p class="mt-5 section-heading">Additional information</p>
								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Current
										Status</label>
									<select class="selectpicker form-control" id="select_tax_item"
										name="estimateStatus">
										<option th:each="estimateStatus : ${estimateStatus}"
											th:value="${estimateStatus}" th:text="${estimateStatus}"
											th:selected="${estimateStatus == estimate.estimateStatus}"></option>
									</select>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Assign
										Sales Person</label> <select class="selectpicker form-control"
										id="select_tax_item" name="salesPerson" required
										th:disabled="${requestForView}">
										<option th:if="${estimate.CustomerDTO != null}"
											th:each="salesPerson : ${salesPersons}"
											th:value="${salesPerson.salesPersonId}"
											th:text="${salesPerson.salesPersonName}"
											th:selected="${estimate.customerDTO.salesPerson}"></option>
										<option th:unless="${estimate.CustomerDTO != null}"
											th:each="salesPerson : ${salesPersons}"
											th:value="${salesPerson.salesPersonId}"
											th:text="${salesPerson.salesPersonName}"></option>
									</select>
								</div>
								<!-- ---Estimate UL-- -Estimate 1, Estimate 2-->
								<div class="heading_plusbutton justify-content-end d-flex align-items-center mt-5 __web-inspector-hide-shortcut__"
									style="margin-top: -7%;">
									<p class="section-heading"></p>
									<button id="btn-add-tab" type="button" class="add_estimates"
										style="margin-right: 2rem;">
										<img th:src="@{/assest/plus_circle.png}" alt=""> Add New
										Estimate
									</button>
								</div>
								<ul th:if="${ estimate.options != null and requestForView}" class="nav nav-tabs"
									id="myTab_custom" role="tablist">
									<li class="nav-item" role="presentation" th:each="option,itr : ${estimate.options}">
										<input type="hidden" th:if="${option.id != null}"
											th:id="'estimate-table'+${itr.index+1}+'EstimateOptionId'"
											th:name="'estimate-table'+${itr.index+1}+'EstimateOptionId'"
											th:value="${option.id}" />
										<button class="nav-link " th:classappend="${(itr.index+1) == 1} ? 'active'"
											th:id="${'tab_label'+(itr.index+1)}" data-bs-toggle="tab"
											th:data-bs-target="${'#tab'+(itr.index+1)}" type="button" role="tab"
											th:aria-controls="${'tab'+(itr.index+1)}" aria-selected="true">
											<div class="row">
												<div class="col-md-9 input-items">
													<img src="/assest/document-signed.svg" class="img-icon me-2">
													<lable class="estimate-nav-item-label">Option
														<span th:text="${(itr.index)+1}"></span>
													</lable>
												</div>
												<div class="col-md-3 input-items">
													<span class="dropdown">
														<div class="nav-user-img" role="button"
															data-bs-toggle="dropdown" aria-expanded="false"
															id="estimateMenu"><img src="/assest/estimate-menu-white.svg"
																class="img-icon" alt="profile name"
																id="estimateMenuWhiteIcon"> <img
																src="/assest/estimate-menu-black.svg"
																class="img-icon d-none" alt="profile name"
																id="estimateMenuBlackIcon"></div>
														<ul class="dropdown-menu estimate-custom-dropdown">
															<li>
																<a th:onclick="'duplicateEstimate('+${(itr.index+1)}+')'"
																	class="dropdown-item"><span>Duplicate</span></a>
																<a th:if="${(itr.index+1)==estimate.options.size()}"
																	th:id="'deleteOptionBtn'+${(itr.index)+1}"
																	class="dropdown-item estimate-close"
																	type="button"><span>Delete</span></a>
															</li>
														</ul>
													</span>
												</div>
											</div>
										</button>
									</li>
								</ul>
								<!--Estimate Content with view-->
								<div th:if="${estimate.options != null and requestForView}" class="tab-content"
									id="myTabContent_custom">
									<div th:each="option,itr : ${estimate.options}" class="tab-pane fade "
										th:classappend="${(itr.index)+1 == 1} ? ' show active'"
										th:id="${'tab'+(itr.index+1)}" role="tabpanel"
										th:aria-labelledby="${'tab_label'+(itr.index+1)}">
										<label>Tab <span th:text="${itr.index+1}"></span> content</label>
										<div class="estimate_report_container">
											<div class="container-fluid custome-data-table mt-5 p-0 overflow-auto">
												<table th:id="${'estimate-table'+(itr.index+1)}"
													th:name="${'estimate-table'+(itr.index+1)}"
													class="table custom-table custom-category-table dt-responsive nowrap w-100">
													<input type="hidden"
														th:name="${'estimate-table'+(itr.index+1)+'-input'}" value=1>
													<thead>
														<tr>
															<th> </th>
															<th width="40%">Product/Service</th>
															<th>Description</th>
															<th>Quantity</th>
															<th>Rate</th>
															<th>Total</th>
															<th>Cost</th>
															<th>Action</th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="optionProduct,optionProductItr : ${option.optionProducts}"
															th:id="${'estimate-table'+(itr.index+1)+'tr'+(optionProductItr.index+1)}">
															<td th:text="${optionProductItr.index+1}"></td>
															<td>
																<div class="input-with-icon"
																	style="position: relative;">
																	<input th:if="${optionProduct.product!=null}"
																		autocomplete="off" type="text"
																		placeholder="Type for search product/service.."
																		class="form-control"
																		th:name="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:id="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:value="${optionProduct.product.productName}"
																		onKeyUp="onSearchType(event)"
																		th:onclick="@{'generateProductRow('+${(itr.index+1)}+')'}">
																	<!--<span th:if="${optionProduct.product!=null}"
																		class="icon-span status-capsule requested"
																		style="border-radius: 10px !important;"
																		th:id="${'estimate-table'+(itr.index+1)+'inp-cap'+(optionProductItr.index+1)}">Product</span>-->
																	<input th:if="${optionProduct.services!=null}"
																		autocomplete="off" type="text"
																		placeholder="Type for search product/service.."
																		class="form-control"
																		th:name="${'estimate-table'+(itr.index+1)+'ServiceName'+(optionProductItr.index+1)}"
																		th:id="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:value="${optionProduct.services.serviceName}"
																		onKeyUp="onSearchType(event)"
																		th:onclick="@{'generateProductRow('+${(itr.index+1)}+')'}">
																	<!--<span th:if="${optionProduct.services!=null}"
																		class="icon-span status-capsule provided"
																		style="border-radius: 10px !important;"
																		th:id="${'estimate-table'+(itr.index+1)+'inp-cap'+(optionProductItr.index+1)}">Service</span>-->
																</div>
																<div th:id="${'estimate-table'+(itr.index+1)+'search_results'+(optionProductItr.index+1)}"
																	class="search-results"></div>
																<!--<label style="color: red;">Please select a product
																	first.</label>-->
															</td>
															<td>
																<input type="text" class="form-control" placeholder=""
																	th:if="${optionProduct.product!=null}"
																	th:value="${optionProduct.product.discription}"
																	th:id="${'estimate-table'+(itr.index+1)+'Description'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Description'+(optionProductItr.index+1)}">
																<input th:if="${optionProduct.services!=null}"
																	type="text" class="form-control" placeholder=""
																	th:value="${optionProduct.services.discription}"
																	th:id="${'estimate-table'+(itr.index+1)+'Description'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Description'+(optionProductItr.index+1)}">
															</td>
															<td>
																<input type="number" class="form-control"
																	placeholder="1"
																	th:id="${'estimate-table'+(itr.index+1)+'Quantity'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Quantity'+(optionProductItr.index+1)}"
																	th:value="${optionProduct.quantity}"
																	onchange="calculateTotal($('#'+this.id))" min="1">
															</td>
															<td>
																<input th:if="${optionProduct.product!=null}"
																	type="text" class="form-control" readonly
																	placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.product.regularPrice, 0, 'COMMA', 2, 'POINT')}">
																<input th:if="${optionProduct.services!=null}"
																	type="text" class="form-control" placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.services.regularPrice, 0, 'COMMA', 2, 'POINT')}"
																	readonly>
															</td>
															<td><input type="text" class="form-control"
																	placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'Total'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Total'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.total, 0, 'COMMA', 2, 'POINT')}"
																	readonly>
															</td>
															<td>
																<input th:if="${optionProduct.product!=null}" readonly
																	type="text" class="form-control" placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'AverageCost'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'AverageCost'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.product.averageCost, 0, 'COMMA', 2, 'POINT')}">
																<input th:if="${optionProduct.product!=null}" readonly
																	type="hidden" class="form-control"
																	placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'AverageCostIntial'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'AverageCostIntial'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.product.averageCost, 0, 'COMMA', 2, 'POINT')}">
																<input th:if="${optionProduct.services!=null}" readonly
																	type="text" class="form-control" placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'AverageCost'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'AverageCost'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.services.internalCost, 0, 'COMMA', 2, 'POINT')}">
																<input th:if="${optionProduct.services!=null}" readonly
																	type="hidden" class="form-control"
																	placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'AverageCostIntial'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'AverageCostIntial'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.services.internalCost, 0, 'COMMA', 2, 'POINT')}">
															</td>
															<td>
																<span>
																	<button type="button" style="cursor: pointer;"
																		th:name="${optionProductItr.index+1}"
																		th:onclick="'removeProductRow('+${itr.index+1}+','+${optionProductItr.index+1}+')'"
																		th:disabled="${(optionProductItr.index+1)==1}"
																		class="table-action-buttons del-btn del-row">
																		<img th:src="@{/assest/trash.svg}"
																			class="img-fluid plan-carousel-btn"
																			alt="icon">
																	</button>
																</span>
															</td>
														</tr>
														<!-- ---Blank Line Item start--- -->
														<tr
															th:id="${'estimate-table'+(itr.index+1)+'tr'+(estimate.options[itr.index].optionProducts.size()+1)}">
															<td
																th:text="${estimate.options[itr.index].optionProducts.size()+1}">
															</td>
															<td>
																<div class="input-with-icon"
																	style="position: relative;">
																	<input type="text"
																		th:onclick="'generateProductRow('+${itr.index+1}+')'"
																		autocomplete="off"
																		placeholder="Type for search product.."
																		class="form-control"
																		th:name="${'estimate-table'+(itr.index+1)+'ProductName'+(estimate.options[itr.index].optionProducts.size()+1)}"
																		th:id="${'estimate-table'+(itr.index+1)+'ProductName'+(estimate.options[itr.index].optionProducts.size()+1)}"
																		value="" onkeyup="onSearchType(event)">
																	<!--<span
																		class="icon-span status-capsule requested d-none"
																		style="border-radius: 10px !important; float: right;"
																		th:id="${'estimate-table'+(itr.index+1)+'inp-cap'+(estimate.options[itr.index].optionProducts.size()+1)}"></span>-->
																</div>
																<div th:id="${'estimate-table'+(itr.index+1)+'search_results'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	class="search-results"></div>
															</td>
															<td>
																<input type="text" class="form-control" placeholder=""
																	th:id="${'estimate-table'+(itr.index+1)+'Description'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Description'+(estimate.options[itr.index].optionProducts.size()+1)}">
															</td>
															<td>
																<input type="number" class="form-control"
																	th:id="${'estimate-table'+(itr.index+1)+'Quantity'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Quantity'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	value="1.0"
																	onchange="calculateTotal($('#'+this.id))" min="1">
															</td>
															<td>
																<input type="text" class="form-control" readonly=""
																	th:id="${'estimate-table'+(itr.index+1)+'Rate'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Rate'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	value="0" onchange="calculateTotal($('#'+this.id))">
															</td>
															<td>
																<input type="text" class="form-control" readonly=""
																	th:id="${'estimate-table'+(itr.index+1)+'Total'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Total'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	value="0">
															</td>
															<td>
																<input type="text" class="form-control" readonly=""
																	th:id="${'estimate-table'+(itr.index+1)+'AverageCost'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'AverageCost'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	value="0">
																<input type="hidden" class="form-control"
																	th:id="${'estimate-table'+(itr.index+1)+'AverageCostIntial'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'AverageCostIntial'+(estimate.options[itr.index].optionProducts.size()+1)}"
																	value="0">
															</td>
															<td>
																<span>
																	<button type="button" style="cursor: pointer;"
																		class="table-action-buttons del-btn del-row"
																		name="2"
																		th:onclick="'removeProductRow('+${itr.index+1}+','+${estimate.options[itr.index].optionProducts.size()+1}+')'"><img
																			src="/assest/trash.svg"
																			class="img-fluid plan-carousel-btn"></button></span>
															</td>
														</tr>
														<!-- ---Blank Line Item end--- -->
														<ul id="search-results"></ul>
													</tbody>
												</table>
											</div>
											<div class="estimate_summary_container mt-5">
												<div class="row">
													<div class="col-lg-6 mb-3 mb-lg-0">
														<label for="inpexpiry" class="form-label">Notes to
															Customer</label>
														<textarea class="form-control custom-area" id="inpexpiry"
															rows="3"></textarea>
													</div>
													<div class="col-lg-6">
														<div class="estimate_summary">
															<div class="order-summary ">
																<h4 class="text-end fs-5">Estimate Summary</h4>
																<hr>
																<div class="plan">
																	<p>Estimate Total :</p>
																	<input type="hidden"
																		th:if="${option.estimateTotal != null}"
																		th:id="'estimate-table'+${itr.index+1}+'EstimateTotal'"
																		th:name="'estimate-table'+${itr.index+1}+'EstimateTotal'"
																		th:value="${option.estimateTotal}" />
																	<input type="hidden"
																		th:unless="${option.estimateTotal != null}"
																		th:id="'estimate-table'+${itr.index+1}+'EstimateTotal'"
																		th:name="'estimate-table'+${itr.index+1}+'EstimateTotal'"
																		value="0.00" />
																	<h5 th:if="${option.estimateTotal != null}"
																		th:id="'estimate-table'+${itr.index+1}+'EstimateTotalTxt'">
																		$<span th:text="${option.estimateTotal}"></span>
																	</h5>
																	<h5 th:unless="${option.estimateTotal != null}"
																		th:id="'estimate-table'+${itr.index+1}+'EstimateTotalTxt'">
																		$0.00
																	</h5>
																</div>
																<div class="plan">
																	<p>Job Cost :</p>
																	<input type="hidden"
																		th:if="${option.jobCost != null}"
																		th:id="'estimate-table'+${itr.index+1}+'JobCost'"
																		th:name="'estimate-table'+${itr.index+1}+'JobCost'"
																		th:value="${option.jobCost}" />
																	<input type="hidden"
																		th:unless="${option.jobCost != null}"
																		th:id="'estimate-table'+${itr.index+1}+'JobCost'"
																		th:name="'estimate-table'+${itr.index+1}+'JobCost'"
																		value="0.00" />
																	<h5 th:if="${option.jobCost != null}"
																		th:id="'estimate-table'+${itr.index+1}+'JobCostTxt'">
																		$<span th:text="${option.jobCost}"></span>
																	</h5>
																	<h5 th:unless="${option.jobCost != null}"
																		th:id="'estimate-table'+${itr.index+1}+'JobCostTxt'">
																		$00.00</h5>
																</div>
																<div class="plan">
																	<p>
																		Gross Profit :
																	</p>
																	<input type="hidden"
																		th:if="${option.grossProfit != null}"
																		th:id="'estimate-table'+${itr.index+1}+'GrossProfit'"
																		th:name="'estimate-table'+${itr.index+1}+'GrossProfit'"
																		th:value="${option.grossProfit}" />
																	<input type="hidden"
																		th:unless="${option.grossProfit != null}"
																		th:id="'estimate-table'+${itr.index+1}+'GrossProfit'"
																		th:name="'estimate-table'+${itr.index+1}+'GrossProfit'"
																		value="0.00" />
																	<h5 th:if="${option.grossProfit != null}"
																		th:id="'estimate-table'+${itr.index+1}+'GrossProfitTxt'">
																		$<span th:text="${option.grossProfit}"></span>
																	</h5>
																	<h5 th:unless="${option.grossProfit != null}"
																		th:id="'estimate-table'+${itr.index+1}+'GrossProfitTxt'">
																		$00.00</h5>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-12">
									<div class="form-submit">
										<a th:href="@{/estimate/estimates}" id="mainPageCancel"
											class="secondary-btn form-btns me-3">Cancel</a>
										<button type="button" onclick="updateAndSendEstimate()"
											class="primary-btn form-btns me-3 saveAndSendBtn" id="addEstimateBtn">Update
											&
											Send
											Estimate</button>
										<button type="submit" class="primary-btn form-btns" id="addEstimateBtn">Update
											Estimate</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/bootstrap-select.min.js}"></script>
	<script th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/js/responsive.bootstrap5.min.js}"></script>
	<script th:src="@{/js/dataTables.bootstrap5.min.js}"></script>
	<script th:src="@{/js/slimselect.js}"></script>
	<script th:src="@{/js/customNewTab.js}"></script>
	<script th:src="@{/js/main.js}"></script>

	<script>
		$(document).ready(function () {
			var originalURL = "";
			$('a').on('click', function (e) {
				if (!window.location.href.includes('/view/') && !event.target.id.includes('mainPageCancel') && !event.target.class.includes('dropdown-item')) {
					var elementType = this.tagName.toLowerCase();
					var isInsideMainDiv = $(this).closest('#add-estimate-parent-div').length > 0;

					if (elementType === "a" && !isInsideMainDiv) {
						originalURL = $(this).attr('href'); // Get the URL of the clicked link
					}

					if ($('#customer_name_input').val() || $('#estimate-table1ProductName1').val()) {
						// Open the modal and prevent the link or button from being followed
						$('#leaveModal').modal('show');
						e.preventDefault();
					}
				}
			});

			// When Leave button in the modal is clicked, redirect to the original link URL
			$('#leaveButton').on('click', function () {
				if (originalURL !== "") {
					window.location.href = originalURL;
				} else {
					// Handle the case when the Leave button is clicked without a previous link
					console.log("Redirect URL not available.");
				}
			});

			// When Cancel button in the modal is clicked, dismiss the modal
			$('#cancelButton').on('click', function () {
				$('#leaveModal').modal('hide');
			});

			// When the modal is hidden, reset the original URL
			$('#leaveModal').on('hide.bs.modal', function () {
				originalURL = "";
			});

			// Listen for browser back button click
			$(window).on('popstate', function () {
				// If the modal is currently open, close it
				if ($('#leaveModal').hasClass('show')) {
					$('#leaveModal').modal('hide');
				}
			});
		});

	</script>

</body>

</html>