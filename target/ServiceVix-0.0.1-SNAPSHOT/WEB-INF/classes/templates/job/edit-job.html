<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ServiceVix</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/dataTables.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/slimselect.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-icons.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.css}">
	<link rel="stylesheet" th:href="@{/https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css}">
	<style>
		.user-image {
			width: 30px;
			height: 30px;
			border-radius: 50%;
			margin-right: 5px;
			vertical-align: middle;
		}

		.user-info {
			display: flex;
			align-items: center;
		}
	</style>

</head>

<body>

	<!--navbar-->
	<div class="body_container d-flex">
		<div th:replace="component/sidebar :: sidebar"></div>
		<div class="main">
			<!-- haeder -->
			<header th:replace="component/topmenu :: topmenu"></header>
			<!-- headerend -->
			<!-- mainconatiner -->
			<!--Remove Page Validation Modal -->
			<div class="modal fade" id="leaveModal" tabindex="-1" role="dialog" aria-labelledby="leaveModalLabel"
				aria-hidden="true">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="leaveModalLabel">Warning</h5>
						</div>
						<div class="modal-body">
							Are you sure you want to leave this page? You will lose your unsaved data.
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="button" class="btn btn-primary" id="leaveButton">Leave</button>
						</div>
					</div>
				</div>
			</div>
			<!-- Remove Page Validation Modal End -->
			<div id="add-estimate-parent-div" class="container-fluid  p-2 p-md-3 p-lg-4 scroll-conatiner">
				<div class="card data-cards ">
					<div class="add-satff-container p-2">
						<div class="data-cards-header d-flex justify-content-between estimate-header">
							<h4>Edit job</h4>
						</div>
						<div class="data-cards-body mt-4">
							<p class="section-heading">Genearal Information</p>
							<form class="row g-4" id="estimate-form" th:action="@{/job/process-update}" method="post">
								<input type="hidden" name="id" th:value="${job.id}" />
								<div class="col-md-6 position-relative">
									<label for="customer_name" class="form-label">Customer
										name</label>
									<input class="form-control" type="text" th:value="${job.CustomerDTO.customerName}"
										name="customerName" id="customer_name_input" onKeyUp="searchCustomer(event)"
										autocomplete="off" readonly>
									<div id="customer_search_results" class="search-results"></div>
								</div>
								<ul id="search-customers"></ul>
								<div class="col-md-6 col-xl-3">
									<label class="form-label">Parent Account Name</label>
									<input class="form-control" id="paren_acc" name="customerParentAccount"
										th:if="${job.CustomerDTO != null}"
										th:readonly="${job.CustomerDTO != null and requestForView}"
										th:value="${job.CustomerDTO.customerParentAccount}" />
									<input th:unless="${job.CustomerDTO != null}" readonly type="text"
										class="form-control" id="paren_acc" name="customerParentAccount">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="multi-email" class="form-label">Email</label>
									<div class="multi-field-wrapper" id="multi_email_wrapper_estimate">
										<div class="multi-fields" id="multi-fields_email">
											<div class="multi-field mb-2" id="multi-field_email">
												<div class="input_and_select">
													<div class="select">
														<select class="selectpicker form-control"
															id="multi-email-estimate" name="estimate_email_multi_select"
															disabled>
															<option
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																th:selected="${job.CustomerDTO.emails[0].emailCategory.toString() == 'PERSONAL'}"
																value="PERSONAL">
																Personal</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																selected="selected" value="PERSONAL">Personal</option>
															<option
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																th:selected="${job.CustomerDTO.emails[0].emailCategory.toString() == 'BUSINESS'}"
																value="BUSINESS">Business</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																selected="BUSINESS" value="PERSONAL">Business</option>
															<option
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																th:selected="${job.CustomerDTO.emails[0].emailCategory.toString() == 'OTHER'}"
																value="OTHER">Other</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																selected="OTHER" value="OTHER">Other</option>
														</select>
													</div>
													<input id="estimate_emailID" name="estimate_email_multi"
														th:if="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.emails) > 0}"
														th:value="${job.CustomerDTO.emails[0].email}"
														th:readonly="${requestForView}" type="text"
														class="form-control">
													<input
														th:unless="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.emails) > 0}"
														id="estimate_emailID" type="text" class="form-control "
														name="contactNumber" readonly>
												</div>
												<button type="button" class="remove-field ">
													<img th:src="@{/assest/cross.svg}" class="img-icon" alt="">
												</button>
											</div>
										</div>
									</div>
								</div>
								<p class="mt-5 section-heading">Service location</p>
								<div class="col-md-6 col-xl-3">
									<label for="location_name" class="form-label">Location
										nickname</label>
									<input type="text" class="form-control" id="location_name"
										name="estimate_email_multi"
										th:if="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].locationNickName}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_location_name" readonly
										th:unless="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="apt_suite" class="form-label">Apt/suite/unit</label>
									<input type="text" class="form-control" id="es_apt_suite"
										th:if="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].unit}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_apt_suite" readonly
										th:unless="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6">
									<label for="loca_address" class="form-label">Address</label>
									<input type="text" class="form-control" id="es_loca_address"
										th:if="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].address}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_loca_address" readonly
										th:unless="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="locat_city" class="form-label">City</label>
									<input type="text" class="form-control" id="es_locat_city"
										th:if="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].city}"
										th:readonly="${requestForView}">
									<input type="text" class="form-control" id="es_locat_city" readonly
										th:unless="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="locat_state" class="form-label">State/Zip</label>
									<input type="text" class="form-control" id="es_locat_state"
										th:if="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].state}"
										th:readonly="${requestForView}">
									<input
										th:unless="${job.CustomerDTO != null and requestForView and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										type="text" class="form-control" id="es_locat_state" readonly>
								</div>
								<p class="mt-5 section-heading">Additional information</p>
								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Current
										Status</label>
									<select class="selectpicker form-control" id="select_tax_item" name="jobStatus">
										<option th:each="jobStatus : ${jobStatus}" th:value="${jobStatus}"
											th:text="${jobStatus}" th:selected="${jobStatus == job.jobStatus}"></option>
									</select>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Assign
										Sales Person</label>
									<select class="selectpicker form-control" id="select_tax_item" name="salesPersonId">
										<option th:if="${job.CustomerDTO != null}"
											th:each="salesPerson : ${salesPersons}"
											th:value="${salesPerson.salesPersonId}"
											th:text="${salesPerson.salesPersonName}"
											th:selected="${job.customerDTO.salesPerson}"></option>
										<option th:unless="${job.CustomerDTO != null}"
											th:each="salesPerson : ${salesPersons}"
											th:value="${salesPerson.salesPersonId}"
											th:text="${salesPerson.salesPersonName}"></option>
									</select>
								</div>
								<div class="col-md-10 col-xl-6 select-container ">
									<select class="multi-select-tech selectpicker" multiple data-live-search="true"
										title="Select Responsibles" name="technicianId">
										<option th:each="staff : ${staffs}" th:value="${staff.userDTO.id}">

											<span class="user-info">
												<img src="/assest/send_invoice.png" th:alt="staff.userDTO.firstName"
													class="user-image">
												<span th:text="${staff.userDTO.firstName}"></span>
												<!--<span th:text="'('+${staff.userDTO.role.name}+')'"></span>-->
											</span>
										</option>
									</select>
								</div>
								<div class="col-xl-4 col-md-6">
									<label for="inpdob" class="form-label">Job Start Date</label>
									<input type="date" class="form-control" id="jobStartDate" name="jobStartDate"
										th:value="${#strings.substring(job.createdAt, 0, 10)}" readonly>
								</div>

								<ul th:if="${ job.options != null and requestForView}" class="nav nav-tabs"
									id="myTab_custom" role="tablist">
									<li class="nav-item" role="presentation" th:each="option,itr : ${job.options}">
										<input type="hidden" th:if="${option.id != null}"
											th:id="'job-table'+${itr.index+1}+'EstimateOptionId'"
											th:name="'job-table'+${itr.index+1}+'EstimateOptionId'"
											th:value="${option.id}" />
										<button class="nav-link " th:classappend="${(itr.index+1) == 1} ? 'active'"
											th:id="${'tab_label'+(itr.index+1)}" data-bs-toggle="tab"
											th:data-bs-target="${'#tab'+(itr.index+1)}" type="button" role="tab"
											th:aria-controls="${'tab'+(itr.index+1)}" aria-selected="true">
											<div class="row">
												<div class="col-md-12 input-items">
													<img src="/assest/document-signed.svg" class="img-icon me-2">
													<lable class="job-nav-item-label">Products/Services
													</lable>
												</div>
											</div>
										</button>
									</li>
								</ul>
								<!--Estimate Content with view-->
								<div th:if="${job.options != null and requestForView}" class="tab-content"
									id="myTabContent_custom">
									<div th:each="option,itr : ${job.options}" class="tab-pane fade "
										th:classappend="${(itr.index)+1 == 1} ? ' show active'"
										th:id="${'tab'+(itr.index+1)}" role="tabpanel"
										th:aria-labelledby="${'tab_label'+(itr.index+1)}">
										<div class="estimate_report_container">
											<div class="container-fluid custome-data-table mt-5 p-0 overflow-auto">
												<table th:id="${'job-table'+(itr.index+1)}"
													th:name="${'job-table'+(itr.index+1)}"
													class="table custom-table custom-category-table dt-responsive nowrap w-100">
													<input type="hidden" th:name="${'job-table'+(itr.index+1)+'-input'}"
														value=1>
													<thead>
														<tr>
															<th> </th>
															<th width="40%">Product/Service</th>
															<th>Description</th>
															<th>Quantity</th>
															<th>Total</th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="optionProduct,optionProductItr : ${option.optionProducts}"
															th:id="${'job-table'+(itr.index+1)+'tr'+(optionProductItr.index+1)}">
															<td th:text="${optionProductItr.index+1}"></td>
															<td>
																<div class="input-with-icon"
																	style="position: relative;">
																	<input th:if="${optionProduct.product!=null}"
																		type="text"
																		placeholder="Type for search product/service.."
																		class="form-control"
																		th:value="${optionProduct.product.productName}"
																		readonly>
																	<input th:if="${optionProduct.services!=null}"
																		placeholder="Type for search product/service.."
																		class="form-control"
																		th:value="${optionProduct.services.serviceName}"
																		readonly>
																</div>
															</td>
															<td>
																<input type="text" class="form-control" placeholder=""
																	th:if="${optionProduct.product!=null}"
																	th:value="${optionProduct.product.discription}"
																	readonly>
																<input th:if="${optionProduct.services!=null}"
																	type="text" class="form-control" placeholder=""
																	th:value="${optionProduct.services.discription}"
																	readonly>
															</td>
															<td>
																<input type="number" class="form-control"
																	placeholder="1" th:value="${optionProduct.quantity}"
																	readonly>
															</td>
															<td><input type="text" class="form-control"
																	placeholder="0.00"
																	th:id="${'job-table'+(itr.index+1)+'Total'+(optionProductItr.index+1)}"
																	th:name="${'job-table'+(itr.index+1)+'Total'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.total, 0, 'COMMA', 2, 'POINT')}"
																	readonly>
															</td>
														</tr>
													</tbody>
												</table>
											</div>
											<div class="job_summary_container mt-5">
												<div class="row">
													<div class="col-lg-6 mb-3 mb-lg-0">
														<label for="inpexpiry" class="form-label">Notes to
															Tech</label>
														<textarea class="form-control custom-area" id="inpexpiry"
															rows="3"></textarea>
													</div>
													<div class="col-lg-6">
														<div class="job_summary">
															<div class="order-summary ">
																<h4 class="text-end fs-5">Summary</h4>
																<hr>
																<div class="plan">
																	<p>Total :</p>
																	<h5 th:if="${option.jobTotal != null}"
																		th:id="'job-table'+${itr.index+1}+'EstimateTotalTxt'">
																		$<span th:text="${option.jobTotal}"></span>
																	</h5>
																	<h5 th:unless="${option.jobTotal != null}"
																		th:id="'job-table'+${itr.index+1}+'EstimateTotalTxt'">
																		$0.00
																	</h5>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-12">
									<div class="form-submit">
										<a th:href="@{/job/jobs}" id="mainPageCancel"
											class="secondary-btn form-btns me-3">Cancel</a>
										<button type="submit" class="primary-btn form-btns">Update
											Job</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/bootstrap-select.min.js}"></script>
	<script th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/js/responsive.bootstrap5.min.js}"></script>
	<script th:src="@{/js/dataTables.bootstrap5.min.js}"></script>
	<script th:src="@{/js/slimselect.js}"></script>
	<script th:src="@{/js/customNewTab.js}"></script>
	<script th:src="@{/js/main.js}"></script>
	<script>
		$(document).ready(function () {
			$('.selectpicker').selectpicker();
		})
	</script>

</body>

</html>