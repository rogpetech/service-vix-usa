<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Service Vix | Edit-Profile</title>
	<link rel="stylesheet" th:href="@{/css/dataTables.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/slimselect.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-icons.min.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.css}">
	<link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css}">
</head>

<body>
	<!--navbar-->
	<div class="body_container d-flex">
		<div th:replace="component/sidebar :: sidebar"></div>
		<div class="main">
			<!-- haeder -->
			<header th:replace="component/topmenu :: topmenu"></header>
			<!-- headerend -->
			<!-- mainconatiner -->
			<div class="container-fluid p-2 p-md-3 p-lg-4 scroll-conatiner">
				<div class="row h-100">
					<div class="col-12">
						<div class="card data-cards h-100">
							<div class="add-satff-container p-2">
								<div class="data-cards-header">
									<div th:if="${session.message != null}" id="popupMessage">
										<div class="alert fade show"
											th:classappend="${session.message.type == 'success'} ? 'alert-success ' : 'alert-danger '"
											role="alert">
											<div th:if="${session.message.type == 'success'}">
												<strong><i class="bi bi-check-circle-fill me-2"></i>Hey! </strong><span
													th:text="${session.message.text}"></span>
											</div>
											<div th:unless="${session.message.type == 'success'}">
												<strong><i class="bi bi-x-circle-fill me-2"></i></i>Oops !
												</strong><span th:text="${session.message.text}"></span>
											</div>
											<button type="button" class="btn-close" data-bs-dismiss="alert"
												aria-label="Close"></button>
										</div>
									</div>
									<h4>Update Profile Details</h4>
									<a style="float: right;">
										<button style="float: right;" type="button" class="primary-btn"
											data-toggle="modal" data-target="#changePasswordModal"> Change
											Password
										</button>
									</a>
									<!-- Modal -->
									<div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog"
										aria-labelledby="changePasswordModalLabel" aria-hidden="true">
										<div class="modal-dialog" role="document">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="changePasswordModalLabel">Change
														Password
													</h5>
												</div>
												<div class="modal-body">
													<form th:action="@{/profile/change-password}" method="post">
														<input type="hidden" name="userId" th:value="${user.id}" />
														<div class="form-group">
															<label for="username" class="form-label">Current
																Password</label>
															<div class="input-group">
																<input type="password" class="form-control"
																	id="currentPasswordInp" placeholder="************"
																	name="currentPasswordInp">
																<button type="button" class="btn btn-outline-secondary"
																	onclick="togglePasswordVisibility('currentPasswordInp','currentPasswordEyeIcon')">
																	<i id="currentPasswordEyeIcon"
																		class="far fa-eye"></i>
																</button>
															</div>
														</div>
														<div class="form-group">
															<label for="username" class="form-label mt-3">New
																Password</label>
															<div class="input-group">
																<input type="password" class="form-control"
																	id="newPasswordInp" placeholder="************"
																	oninput="validatePassword()">
																<button type="button" class="btn btn-outline-secondary"
																	onclick="togglePasswordVisibility('newPasswordInp','newPasswordEyeIcon')">
																	<i id="newPasswordEyeIcon" class="far fa-eye"></i>
																</button>
																<span id="newPasswordError"
																	style="color:red;font-size: 13px;"></span>
															</div>
														</div>
														<div class="form-group">
															<label for="username" class="form-label mt-3">Confrim
																Password</label>
															<div class="input-group">
																<input type="password" class="form-control"
																	id="confrimPasswordInp" placeholder="************"
																	oninput="matchPassword()" name="confrimPasswordInp">
																<button type="button" class="btn btn-outline-secondary"
																	onclick="togglePasswordVisibility('confrimPasswordInp','confrimPasswordEyeIcon')">
																	<i id="confrimPasswordEyeIcon"
																		class="far fa-eye"></i>
																</button>
																<br>
															</div>
															<span id="confrimPasswordError"
																style="font-size: 13px;"></span>
														</div>
														<div class="form-group mt-3">
															<button type="submit" id="changePasswordBtn"
																class="primary-btn" disabled style="opacity: .1;">Change
																Password</button>
														</div>
													</form>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="data-cards-body mt-4">
									<form class="row g-4" th:action="@{/organization/process-update-profile}"
										method="post" enctype="multipart/form-data">
										<div class="row mt-5"
											th:if="${#strings.contains(#authentication.principal.authorities, 'ORGANIZATION')}">
											<p class="section-heading">Organization Details</p>
											<div class="col-xl-3 col-lg-4">
												<div class="custome-image">
													<div class="avatar-upload">
														<div class="avatar-edit">
															<input type="file" id="imageUpload" value="" accept=".png"
																name="organizationLogoMultipart">
															<label for="imageUpload"></label>
														</div>
														<div class="avatar-preview">
															<img id="imagePreviewImg"
																th:src="${(user.organizationLogoURL != null) ? '/project_image/' +user.organizationLogoURL :'No image' }"
																alt="org logo"
																style="width: 100%; height: 100%;border-radius: 19px;"
																name="profilePicture">
															<div id="imagePreview" class="d-none"
																style="border-radius: 19px;">
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-8 col-xl-9">
												<div class="row g-4">
													<input th:if="${user.organizationDTO!=null}" type="hidden"
														name="organizationDTO.id" th:value="${user.organizationDTO.id}">
													<div class="col-xl-4 col-md-6">
														<label for="organization-name" class="form-label">Organization
															Name</label>
														<input type="text" class="form-control" id="organization-name"
															th:value="${user.organizationDTO.orgName}"
															name="organizationDTO.orgName">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="inpemail" class="form-label">Email</label>
														<input type="email" class="form-control" id="inpemail"
															th:value="${user.organizationDTO.orgEmail}"
															name="organizationDTO.orgEmail">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="inpmobile" class="form-label">Mobile</label>
														<input type="number" class="form-control" id="inpmobile"
															th:value="${user.organizationDTO.orgMobNum}"
															name="organizationDTO.orgMobNum">
													</div>
													<div class="col-xl-4 col-md-4">
														<label for="org-address" class="form-label">Address</label>
														<input type="text" class="form-control" id="org-address"
															th:value="${user.organizationDTO.orgAddress}"
															name="organizationDTO.orgAddress">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="inputcountry" class="form-label">Country</label>
														<select id="inputcountry" th:name="organizationDTO.orgCountry"
															class="form-select" name="organizationDTO.orgCountry">
															<option selected disabled>-Select Country--</option>
															<option th:each="country : ${countries}"
																th:value="${country}"
																th:selected="${country.toString()==user.organizationDTO.orgCountry}"
																th:text="${country}"></option>
														</select>
													</div>
												</div>
											</div>
										</div>
										<div class="row mt-5">
											<p class="section-heading">User Details</p>
											<input type="hidden" name="id" th:value="${user.id}">
											<div class="col-xl-3 col-lg-4">
												<div class="custome-image">
													<div class="avatar-upload">
														<div class="avatar-edit">
															<input type="file" id="imageUpload0" accept=".png" value=""
																name="userProfileMultipart">
															<label for="imageUpload0"></label>
														</div>
														<div class="avatar-preview">
															<img id="imagePreviewImg0"
																th:src="${(user.userProfilePictureURL != null) ? '/project_image/' +user.userProfilePictureURL :'No image' }"
																alt="user profile"
																style="width: 100%; height: 100%;border-radius: 19px;"
																name="profilePicture">
															<div id="imagePreview0" class="d-none"
																style="border-radius: 19px;"></div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-lg-8 col-xl-9">
												<div class="row g-4">
													<div class="col-xl-4 col-md-6">
														<label for="username" class="form-label">User Name</label>
														<input type="text" class="form-control" id="username"
															name="username" th:value="${user.username}" readonly>
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="first-name" class="form-label">First name</label>
														<input type="text" class="form-control" id="first-name"
															th:value="${user.firstName}" name="firstName">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="last-name" class="form-label">Last name</label>
														<input type="text" class="form-control" id="last-name"
															th:value="${user.lastName}" name="lastName">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="organization-email" class="form-label">Email</label>
														<input type="text" class="form-control" id="organization-email"
															th:value="${user.email}" name="email">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="organization-mobile"
															class="form-label">Mobile</label>
														<input type="text" class="form-control" id="organization-mobile"
															th:value="${user.mobileNum}" name="mobileNum">
													</div>
													<div class="col-xl-4 col-md-6">
														<label for="select_gender" class="form-label">Gender</label>
														<select class="selectpicker form-control" id="select_gender"
															name="gender">
															<option value="Male" th:selected="${user.gender==Male}">Male
															</option>
															<option value="Female" th:selected="${user.gender==Female}">
																female
															</option>
														</select>
													</div>
												</div>
											</div>
										</div>
										<div col-xl-4 col-md-6>
											<div class="form-submit">
												<a th:href="@{/dashboard/organization}"><button type="button"
														class="secondary-btn form-btns me-3">Cancel</button></a>
												<button type="submit" class="primary-btn form-btns">Update
													Details
												</button>
											</div>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
		integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
		integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
		integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
		crossorigin="anonymous"></script>

	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/js/responsive.bootstrap5.min.js}"></script>
	<script th:src="@{/js/dataTables.bootstrap5.min.js}"></script>
	<script th:src="@{/js/initializeDataTables.js}"></script>
	<script th:src="@{/js/main.js}"></script>
	<script>

		function togglePasswordVisibility(id, eyeIconId) {
			const passwordInput = document.getElementById(id);
			const eyeIcon = document.getElementById(eyeIconId);

			if (passwordInput.type === "password") {
				passwordInput.type = "text";
				eyeIcon.classList.remove("fa-eye");
				eyeIcon.classList.add("fa-eye-slash");
			} else {
				passwordInput.type = "password";
				eyeIcon.classList.remove("fa-eye-slash");
				eyeIcon.classList.add("fa-eye");
			}
		}

		function matchPassword() {
			var changePasswordBtn = document.getElementById("changePasswordBtn");
			var password = $("#newPasswordInp").val();
			var confirmPassword = $("#confrimPasswordInp").val();
			if (password != confirmPassword) {
				$("#confrimPasswordError").html("Password does not match !").css("color", "red");
				btnVisibility(false);
			}
			else {
				$("#confrimPasswordError").html("Password match !").css("color", "green");
				btnVisibility(true);
			}
		}

		function btnVisibility(visibility) {
			if (visibility) {
				$(changePasswordBtn).prop('disabled', false);
				$(changePasswordBtn).css("opacity", "1");
			} else {
				$(changePasswordBtn).prop('disabled', true);
				$(changePasswordBtn).css("opacity", ".1");
			}
		}

		function validatePassword() {
			var password = document.getElementById("newPasswordInp").value;
			var passwordPattern = /^(?=.*[!@#$%^&*-_]).{8,}$/;
			var passwordError = document.getElementById("newPasswordError");
			if (!passwordPattern.test(password)) {
				passwordError.textContent = "Password should be contains Letters,special character or number";
			} else {
				passwordError.textContent = "";
			}
		}
	</script>
</body>

</html>