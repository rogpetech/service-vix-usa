<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ServiceVix</title>

	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-icons.min.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<style>
		.hidden {
			display: none;
		}

		#OrganizationnameError {
			display: none;
			font-size: -0.2em;
		}

		#OrganizationnameError.visible {
			display: block;
		}

		input.invalid {
			border-color: red;
		}
	</style>

</head>

<body>
	<!-- ----------------------------registration--------------------------------- -->

	<div class="container-fluid p-0">
		<div class="row m-0">
			<!-- ----------greenbgwithstepper-------------->
			<div class="col-lg-3 p-0">
				<div class="green-bg-container">
					<div class="green-bg h-100">
						<h1>A few steps away from creating your office</h1>
						<div class="step-wizard">
							<ul id="progressbar">
								<li class="step active">General Information</li>
								<li class="step">Admin Information</li>
								<!--<li class="step">Choose Plan</li>
								<li class="step">Make Payment</li>-->
							</ul>
						</div>
						<div class="banner-image">
							<img th:src="@{/assest/sidebar abnner.png}" alt="" class="img-fluid">
						</div>
					</div>
				</div>
			</div>
			<!-- ----------registratiomformstepps------------ -->
			<div class="col-lg-9">
				<div class="signup-process">
					<img src="@{/assest/cropped-LOGO-2-PNG-1.png}" alt="" class="signup-logo img-fluid">
					<form id="mainForm" th:action="@{/organization/process-add-organization}" th:object="${userDTO}"
						method="post" role="form" enctype="multipart/form-data" onsubmit="return validateEmail();">
						<!-- ---------------oragnizationdetails------------- -->
						<div class="card2 first-screen show ml-2">
							<div class="organization-details-container">
								<h3 class="mt-5 fw-sm">Register your Organization</h3>
								<h6 class="label-color">Fill your organization details</h6>
								<!-- Alert message -->
								<div
									th:if="${session.message != null && session.message.text != 'You are not authenticated Please use valid credentials to login !'}">
									<div class="alert alert-success alert-dismissible "
										th:classappend="${session.message.type == 'success'} ? 'alert-success ' : 'alert-danger '"
										role="alert">
										<div th:if="${session.message.type == 'success'}">
											<strong><i class="bi bi-check-circle-fill me-2"></i>Hey! </strong><span
												th:text="${session.message.text}"></span>
										</div>
										<div th:unless="${session.message.type == 'success'}">
											<strong><i class="bi bi-x-circle-fill me-2"></i></i>Oops ! </strong><span
												th:text="${session.message.text}"></span>
										</div>
										<button type="button" class="btn-close" data-bs-dismiss="alert"
											aria-label="Close"></button>
									</div>
								</div>
								<div class="row g-3 mt-3 justify-content-between">
									<div class="col-md-5">
										<label for="Organizationname" class="form-label">Organization name</label>
										<input type="text" th:name="organizationDTO.orgName"
											th:field="*{organizationDTO.orgName}" class="form-control"
											id="Organizationname" placeholder="John" required autocomplete="off">
										<div id="OrganizationnameError"></div>
									</div>
									<!--<div class="col-md-5">
										<label for="Ownername" class="form-label">Full name</label>
										<input type="text" th:name="organizationDTO.orgOwnerName" class="form-control"
											id="OrganizationOwnerName" placeholder="Ownername">
									</div>-->
									<div class="col-md-5">
										<label for="inputEmail4" class="form-label">Email</label>
										<input type="email" th:name="organizationDTO.orgEmail" class="form-control"
											id="orgEmail" placeholder="alex@xyz.com" oninput="validateEmail()">
										<span id="emailError" style="color:red;"></span>
									</div>
									<div class="col-md-5">
										<label for="inputnumer" class="form-label">Mobile</label>
										<input type="number" th:name="organizationDTO.orgMobNum" class="form-control"
											id="orgMobNum" placeholder="1234567891" oninput="validateMobile()">
										<span id="mobileError" style="color:red;"></span>
									</div>
									<div class="col-md-5">
										<label for="inputAddress" class="form-label">Address</label>
										<input type="text" th:name="organizationDTO.orgAddress" class="form-control"
											id="inputAddress" placeholder="1234 Main St">
									</div>
									<div class="col-md-5">
										<label for="inputcountry" class="form-label">Country</label>
										<select id="inputcountry" th:name="organizationDTO.orgCountry"
											class="form-select ">
											<option value="">--Select Country--</option>
											<option th:each="country : ${countries}" th:value="${country}"
												th:text="${country}" th:selected="${country == 'United States'}">
											</option>
										</select>
									</div>
									<div class="col-md-5 position-relative">
										<label class="form-label">Company Logo</label>
										<div class="upload__box">
											<div class="upload__img-wrap"></div>
											<div class="upload__btn-box">
												<label class="upload__btn primary-btn">Upload
													images <input type="file" data-max_length="20"
														class="upload__inputfile" name="organizationLogoMultipart"
														accept=".png" required>
												</label>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- ---------------admindetails------------- -->
						<div class="card2 ml-2 admin-card">
							<div class="admin-details-container">

								<h3 class="mt-5 fw-sm">Register your Organization</h3>
								<h6 class="label-color">Fill your Admin details</h6>

								<div class="row g-3 mt-3 justify-content-between">
									<div class="col-md-5">
										<label for="firstname" class="form-label">First name</label>
										<input type="text" th:name="firstName" class="form-control" id="firstname"
											placeholder="John">
									</div>
									<div class="col-md-5">
										<label for="lastname" class="form-label">Last name</label>
										<input type="text" th:name="lastName" class="form-control" id="lastname"
											placeholder="Doe">
									</div>

									<div class="col-md-5">
										<label for="username" class="form-label">User name</label>
										<input type="text" th:name="username" class="form-control" id="username"
											placeholder="johnd@123">
										<!--<span id="userNameError" style="color:red;"></span>-->
										<div id="msg"></div>
									</div>

									<div class="col-md-5">
										<label for="gender" class="form-label">Gender</label>

										<select id="gender" th:name="gender" class="form-select ">
											<option selected>Male</option>
											<option>Female</option>
										</select>
									</div>
									<div class="col-md-5">
										<label for="password" class="form-label">Password</label>
										<div class="input-group">
											<input type="password" th:name="password" class="form-control" id="password"
												placeholder="************" oninput="validatePassword()">
											<button type="button" class="btn btn-outline-secondary"
												onclick="togglePasswordVisibility()">
												<i id="eyeIcon" class="far fa-eye"></i>
											</button>
											<span id="passwordError" style="color:red;"></span>
										</div>
									</div>
									<div class="col-md-5">
										<label for="password" class="form-label">Confrim Password</label>
										<div class="input-group">
											<input type="password" class="form-control" id="confirm-password"
												placeholder="************">
											<button type="button" class="btn btn-outline-secondary"
												onclick="togglePasswordVisibilityy()">
												<i id="eyeIconn" class="far fa-eye"></i>
											</button>
										</div>
									</div>
									<div style="margin-top: 7px;" id="CheckPasswordMatch"></div>
								</div>
							</div>
						</div>
						<!-- ---------------chooseplan------------- -->
						<!-- ---------------makepayment------------- -->
						<!-- ---------------paymentsuccess------------- -->

						<div class="next-btn float-end mt-5">
							<button type="button" class="secondary-btn prev " id="back">Back</button>
							<button type="button" class="primary-btn next-button" disabled style="opacity: .5;"
								data-toggle="tooltip" data-placement="top" title="Please fill all values">Next</button>
							<button type="button" class="primary-btn add-org-button d-none"
								onclick="mainFormSubmit()">Add Organization</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<script>
		function mainFormSubmit() {
			var form = document.getElementById("mainForm");
			form.submit();
		}
	</script>
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/main.js}"></script>
	<script th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/js/dataTables.responsive.min.js}"></script>

	<script>
		function togglePasswordVisibility() {
			const passwordInput = document.getElementById("password");
			const eyeIcon = document.getElementById("eyeIcon");

			if (passwordInput.type === "password") {
				passwordInput.type = "text";
				eyeIcon.classList.remove("fa-eye");
				eyeIcon.classList.add("fa-eye-slash");
			} else {
				passwordInput.type = "password";
				eyeIcon.classList.remove("fa-eye-slash");
				eyeIcon.classList.add("fa-eye");
			}
		}
	</script>
	<script>
		function togglePasswordVisibilityy() {
			const passwordInput = document.getElementById("confirm-password");
			const eyeIcon = document.getElementById("eyeIconn");

			if (passwordInput.type === "password") {
				passwordInput.type = "text";
				eyeIcon.classList.remove("fa-eye");
				eyeIcon.classList.add("fa-eye-slash");
			} else {
				passwordInput.type = "password";
				eyeIcon.classList.remove("fa-eye-slash");
				eyeIcon.classList.add("fa-eye");
			}
		}
	</script>

	<script>
		$(document).ready(function () {
			$("#confirm-password").on('keyup', function () {
				var password = $("#password").val();
				var confirmPassword = $("#confirm-password").val();
				if (password != confirmPassword)
					$("#CheckPasswordMatch").html("Password does not match !").css("color", "red");
				else
					$("#CheckPasswordMatch").html("Password match !").css("color", "green");
			});
		});
	</script>
	<script>
		$(document).ready(function () {
			$("#confirm-password").on('keyup', function () {
				var password = $("#password").val();
				var confirmPassword = $("#confirm-password").val();
				if (password != confirmPassword)
					$("#CheckPasswordMatch").html("Password does not match !").css("color", "red");
				else
					$("#CheckPasswordMatch").html("Password match !").css("color", "green");
			});
		});
	</script>
	<script>
		/* Validation for organization email*/
		function validateEmail() {
			var email = document.getElementById("orgEmail").value;
			var emailPattern = new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$");
			var emailError = document.getElementById("emailError");
			if (!emailPattern.test(email)) {
				emailError.textContent = "Invalid email address";
				$('.next-button').prop('disabled', true).css('opacity', 0.5);
			}
			else {
				emailError.textContent = "";
				$('.next-button').prop('disabled', false).css('opacity', 1.0);
			}
		}
		/* Validation for organization mobile*/
		function validateMobile() {
			var mobile = document.getElementById("orgMobNum").value;
			var mobilePattern = /^\d{10}$/;
			var mobileError = document.getElementById("mobileError");
			if (!mobilePattern.test(mobile)) {
				mobileError.textContent = "Invalid mobile number";
				$('.next-button').prop('disabled', true).css('opacity', 0.5);
			}
			else {
				mobileError.textContent = "";
				$('.next-button').prop('disabled', false).css('opacity', 1.0);
			}
		}
		/* Validation for user email*/
		function validateUserEmail() {
			var email = document.getElementById("email").value;
			var emailPattern = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
			var emailError = document.getElementById("userEmailError");
			if (!emailPattern.test(email)) {
				emailError.textContent = "Invalid email address";
				$('.add-org-button').prop('disabled', true).css('opacity', 0.5);
			}
			else {
				emailError.textContent = "";
				$('.add-org-button').prop('disabled', false).css('opacity', 1.0);
			}
		}
		/* Validation for user mobile*/
		function validateUserMobile() {
			var mobile = document.getElementById("number").value;
			var mobilePattern = /^\d{10}$/;
			var mobileError = document.getElementById("userMobileError");
			if (!mobilePattern.test(mobile)) {
				mobileError.textContent = "Invalid mobile number";
				$('.add-org-button').prop('disabled', true).css('opacity', 0.5);
			}
			else {
				mobileError.textContent = "";
				$('.add-org-button').prop('disabled', false).css('opacity', 1.0);
			}
		}

		function validateUserName() {
			var userName = document.getElementById("username").value;
			var userNamePattern = /^(?=.*[!@#$%^&*-_]).{8,}$/;
			var userNameError = document.getElementById("userNameError");
			if (!userNamePattern.test(userName)) {
				userNameError.textContent = "Username should be contains Letters,special character or number";
			}
			else {
				userNameError.textContent = "";
			}
		}
		function validatePassword() {
			var password = document.getElementById("password").value;
			var passwordPattern = /^(?=.*[!@#$%^&*-_]).{8,}$/;
			var passwordError = document.getElementById("passwordError");
			if (!passwordPattern.test(password)) {
				passwordError.textContent = "Password should be contains Letters,special character or number";
			}
			else {
				passwordError.textContent = "";
			}
		}
	</script>
	<script>
		document.addEventListener('keyup', function (k) {
			if ($("#Organizationname").val() && $("#orgEmail").val() && $("#orgMobNum").val() && $("#inputAddress").val()) {
				$('.next-button').prop('disabled', false).css('opacity', 1.0);
			} else {
				$('.next-button').prop('disabled', true).css('opacity', 0.5);
			}
			if ($("#firstname").val() && $("#lastname").val() && $("#username").val() && $("#password").val() && $("#confirm-password").val()) {
				$('.add-org-button').prop('disabled', false).css('opacity', 1.0);
			} else {
				$('.add-org-button').prop('disabled', true).css('opacity', 0.5);
			}
		});
	</script>

	<script type="text/javascript">
		$(document).ready(function () {

			$("#Organizationname").on("keyup", function () {
				var url = '/organization/orgNameExists/' + $("#Organizationname").val();
				if ($('#Organizationname').val() == "") {
					$('#OrganizationnameError').show();
					$("#OrganizationnameError").html("Organization name is required.").css("color", "red");
				} else {
					$("#OrganizationnameError").html("");
					$.ajax({
						type: 'GET',
						url: url,
						success: function (msg) {
							$('#OrganizationnameError').show();
							if (msg) {
								$("#OrganizationnameError").html("Organization already exists with this name.").css("color", "red");
							} else {
								$("#OrganizationnameError").html("Organization name available.").css("color", "green");
							}
						},
						error: function (jqXHR, textStatus, errorThrown) {
						}
					});
				}
			});

			$("#username").on("keyup", function (e) {
				var username = $('#username').val();
				if ($('#username').val() == null || $('#username').val() == "") {
					$('#msg').show();
					$("#msg").html("Username is required.").css("color", "red");
				} else {
					var regex =
						/^(?=.*[!@#$%^&*-_]).{8,}$/;
					if (!regex.test(username)) {
						$('#msg').show();
						$("#msg").html("Invalid UserName").css("color", "red");
						return;
					}
					$.ajax({
						type: 'GET',
						url: '/organization/searchByName/' + username,
						cache: false,
						beforeSend: function (f) {

							$('#msg').show();
							$('#msg').html('Checking...');

						},
						success: function (msg) {
							$('#msg').show();

							$.each(msg, function (index, value) {
								console.log(value)
								console.log(index)
								if (value === 'username already exists') {
									$("#msg").html(value).css("color", "red");
								} else {
									$("#msg").html(value).css("color", "green");
								}
							});

						},
						error: function (jqXHR, textStatus, errorThrown) {
							alert("fail");
							$('#msg').show();
							$("#msg").html(textStatus + " " + errorThrown).css("color", "red");
						}
					});
				}
			});
		});

	</script>
</body>

</html>