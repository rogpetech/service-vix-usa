<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ServiceVix | Add/View Estimate</title>
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/css/dataTables.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.bootstrap5.min.css}">
	<link rel="stylesheet" th:href="@{/css/slimselect.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-icons.min.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap-select.min.css}">
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/responsive.css}">
	<link rel="stylesheet" th:href="@{/https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css}">
	<style>
		#container {
			padding: 15px;
			/* border: 3px solid #000*/
		}

		#container table {
			border-collapse: collapse;
		}

		/* #container th {resize:horizontal;overflow:auto} */
		#container th,
		#container td {
			/* border: 1px solid black;*/
			padding: 8px
		}
	</style>

</head>

<body>

	<!--navbar-->

	<div class="body_container d-flex">
		<div th:replace="component/sidebar :: sidebar"></div>
		<div class="main">
			<!-- haeder -->
			<header th:replace="component/topmenu :: topmenu"></header>
			<!-- headerend -->
			<div id="add-job-parent-div" class="container-fluid  p-2 p-md-3 p-lg-4 scroll-conatiner">
				<!-- print_job_Modal -->
				<div class="" id="printEstimateModal">
					<div class="modal fade" id="printJModal" tabindex="-1" role="dialog"
						aria-labelledby="printJModalLabel" aria-hidden="true">
						<div class="modal-dialog modal-lg" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="printJModalLabel">Preview PDF</h5>
								</div>
								<div class="modal-body">
									<div class="row">
										<div class="col-md-12 scroll-conatiner">
											<!--job PDF HTML View start-->
											<div id="invoiceholder">
												<div id="print-job" class="effect2"
													style="position: relative;margin: 0 auto;background: #FFF;">
													<div id="invoice-top"
														style="padding: 20px;border-bottom: 2px solid #00a63f;">
														<img id="" class="custmImagelogo"
															th:if="${#authentication.principal.dataHelper.loggedInOrganizationProfileURL !=null}"
															th:src="${(#authentication.principal.dataHelper.loggedInOrganizationProfileURL != null) ? '/project_image/' 											+#authentication.principal.dataHelper.loggedInOrganizationProfileURL :'No image' }"
															alt="org logo" />
														<h4
															th:text="${#authentication.principal.dataHelper.loggedInOrganizationDetails.orgName}">
															Org Name</h4>
														<div class="title" style="margin-top: -10px;float: right;">
															<h1 style="font-size: 1.5em;color: #444;">Job <span
																	th:text="${job.id}"></span>.<span
																	th:text="${job.options[0].id}"></span></h1>
															<p
																style="font-size: .75em;color: #666;line-height: 1.2em;text-align: right;">
																Job
																Date: <span
																	th:text="${#strings.substring(job.createdAt, 0, 10)}"></span>
															</p>
														</div>
														<!--End Title-->
													</div>
													<!--End InvoiceTop-->
													<div id="invoice-mid" style="padding: 20px;min-height: 110px;">
														<div id="message" style="margin-bottom: 30px;display: block;">
															<h2 style="font-size: .9em;margin-bottom: 5px;color: #444;">
																Hello <span
																	th:text="${job.customerDTO.customerName}"></span>,
															</h2>
															<p style="font-size: .75em;color: #666;line-height: 1.2em;">
																An
																Job with ID number
																Job <span th:text="${job.id}"></span>.<span
																	th:text="${job.options[0].id}"></span> is
																created and
																is waiting for your approval.</p>
															<!--<a href="javascript:void(0);">Click here</a> to login </p>-->
														</div>
														<div class="clearfix">
															<div class="col-left" style="float: left;">
																<div class="clientinfo"
																	style="display: inline-block;vertical-align: middle;margin-left: 20px;">
																	<h2 id="supplier"
																		style="font-size: .9em;margin-bottom: 5px;color: #444;"
																		th:text="${job.customerDTO.customerName}">
																	</h2>
																	<p
																		style="font-size: .75em;color: #666;line-height: 1.2em;">
																		<span id="address"
																			th:text="${job.customerDTO.storedServiceLocations[0].locationNickName}"></span><br>
																		<span id="city"
																			th:text="${job.customerDTO.storedServiceLocations[0].city}"></span><br><span
																			th:text="${job.customerDTO.storedServiceLocations[0].address}"></span>
																		<span id="zip"
																			th:text="${job.customerDTO.storedServiceLocations[0].state}"></span><br><span
																			id="tax_num"
																			th:text="${job.customerDTO.contactNumbers[0].number}"></span><br>
																	</p>
																</div>
															</div>
															<div class="col-right" style="float: right;"></div>
														</div>
													</div>
													<!--End Invoice Mid-->
													<div id="estimateOptionsHTMLView">
														<div id="option1HTMLView" class="" style="padding: 20px">
															<h3
																style="font-weight: bold;font-size: 1.2em;line-height: 2em;margin-top: 6%;">
																Option
															</h3>
															<div id="table">
																<table class="table-main"
																	style="width: 100%;border-collapse: collapse;"
																	id="estimateOptionsTblHTMLView1">
																	<thead>
																		<tr class="tabletitle">
																			<th
																				style="font-size: 0.85em;text-align: left;padding: 5px 10px;border-bottom: 2px solid #ddd;">
																				Product/Service</th>
																			<th class="optionTotalHeadHTMLView"
																				style="font-size: 0.85em;text-align: left;padding: 5px 10px;border-bottom: 2px solid #ddd;">
																				Description</th>
																			<th class="optionQuantityHeadHTMLView"
																				style="font-size: 0.85em;text-align: left;padding: 5px 10px;border-bottom: 2px solid #ddd;">
																				Quantity</th>
																			<th class="optionRateHeadHTMLView"
																				style="font-size: 0.85em;text-align: left;padding: 5px 10px;border-bottom: 2px solid #ddd;">
																				Rate</th>
																			<th class="optionTotalHeadHTMLView"
																				style="font-size: 0.85em;text-align: left;padding: 5px 10px;border-bottom: 2px solid #ddd;">
																				Total</th>
																		</tr>
																	</thead>
																	<tr class="list-item"
																		th:each="optionProducts : ${job.options[0].optionProducts}">
																		<td data-label="Type" class="tableitem"
																			style="padding: 10px;border-bottom: 1px solid #cccaca;font-size: 0.85em;text-align: left;">
																			<span
																				th:if="${optionProducts.productName!=null}"
																				th:text="${optionProducts.product.productName}"></span>
																			<span
																				th:unless="${optionProducts.productName!=null}"
																				th:text="${optionProducts.services.serviceName}"></span>
																		</td>
																		<td data-label="Type" class="tableitem"
																			style="padding: 10px;border-bottom: 1px solid #cccaca;font-size: 0.85em;text-align: left;">
																			<span
																				th:if="${optionProducts.productDiscription!=null}"
																				th:text="${optionProducts.productDiscription}"></span>
																			<span
																				th:unless="${optionProducts.productDiscription!=null}"
																				th:text="${optionProducts.serviceDiscription}"></span>
																		</td>
																		<td data-label="Quantity"
																			class="optionQuantityTextHTMLView"
																			style="padding: 10px;border-bottom: 1px solid #cccaca;font-size: 0.85em;text-align: left;">
																			<span
																				th:text="${optionProducts.quantity}"></span>
																		</td>
																		<td data-label="Rate"
																			class="optionRateTextHTMLView"
																			style="padding: 10px;border-bottom: 1px solid #cccaca;font-size: 0.85em;text-align: left;">
																			<span
																				th:if="${optionProducts.productName!=null}"
																				th:text="'$'+${#numbers.formatDecimal(optionProducts.product.regularPrice, 0, 'COMMA', 2, 'POINT')}"></span>
																			<span
																				th:unless="${optionProducts.productName!=null}"
																				th:text="'$'+${#numbers.formatDecimal(optionProducts.services.regularPrice, 0, 'COMMA', 2, 'POINT')}"></span>
																		</td>
																		<td data-label="Total"
																			class="optionTotalTextHTMLView"
																			style="padding: 10px;border-bottom: 1px solid #cccaca;font-size: 0.85em;text-align: left;">
																			<span
																				th:text="'$'+${#numbers.formatDecimal(optionProducts.total, 0, 'COMMA', 2, 'POINT')}"></span>
																		</td>
																	</tr>
																</table>
															</div>
															<!--End Table-->
															<div class="optionGrandTotal"
																style="text-align: right;padding: 20px 0;font-weight: 600;">
																<span>Grand Total: </span>
																<span
																	th:text="'$'+${#numbers.formatDecimal(job.options[0].jobTotal, 0, 'COMMA', 2, 'POINT')}"></span>
															</div>
														</div>
													</div>
												</div>
												<!--End Invoice-->
											</div>
											<!--job PDF HTML View End-->
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary"
										data-bs-dismiss="modal">Cancel</button>
									<button type="button" class="btn btn-success" id="printEButton"
										onclick="handlePrint()">Print</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- print_job_Modal_end -->
				<div class="card data-cards">
					<div class="add-satff-container p-2">
						<div class="data-cards-body mt-4">
							<div class="data-cards-header d-flex justify-content-between estimate-header">
								<h4>View Job</h4>
								<div class="estimate_actions">
									<button type="button" th:onclick="'getJobDetailsForPrint('+${job.id}+')'">
										<img th:src="@{/assest/print.svg}" class="img-icon" alt="">Print
									</button>
									<a th:href="@{'/job/update/'+${job.id}}"><button type="button"><img
												th:src="@{/assest/pencil.svg}" class="img-icon" alt="">Edit</button></a>
								</div>
							</div>
							<p class="section-heading mt-5">Genearal Information</p>
							<form class="row g-4" id="estimate-form" th:action="@{/job/process-add}" method="post">
								<div class="col-md-6 position-relative">
									<label for="customer_name" class="form-label">Customer
										name</label>
									<input class="form-control" type="text" name="customerName"
										th:value="${job.customerDTO.customerName}"
										th:if="${job.customerDTO.customerName!=null}" readonly>
									<input th:unless="${job.customerDTO.customerName!=null}" class="form-control"
										type="text" name="customerName" value="" readonly>
								</div>
								<div class="col-md-6 col-xl-3">
									<label class="form-label">Parent Account Name</label>
									<input class="form-control" id="paren_acc" name="customerParentAccount"
										th:if="${job.customerDTO.customerParentAccount!=null}"
										th:value="${job.customerDTO.customerParentAccount}" readonly />
									<input class="form-control" id="paren_acc" name="customerParentAccount"
										th:unless="${job.customerDTO.customerParentAccount!=null}"
										th:value="${job.customerDTO.customerParentAccount}" readonly />
								</div>
								<div class="col-md-6 col-xl-3 me-5">
									<label for="multi-mobile" class="form-label">Mobile</label>
									<div class="multi-field-wrapper" id="multi_mobile_wrapper_estimate">
										<div class="multi-fields">
											<div class="multi-field mb-2">
												<div class="input_and_select">
													<div class="select">
														<select class="selectpicker form-control" id="multi-mobile"
															disabled name="sel[]">
															<option value="MOBILE"
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
																th:selected="${job.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'MOBILE'}">
																Mobile</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
																selected="selected" value="MOBILE">Mobile</option>
															<option value="HOME"
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
																th:selected="${job.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'HOME'}">
																Home</option>
															<option value="HOME"
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}">
																Home</option>
															<option value="WORK"
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
																th:selected="${job.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'WORK'}">
																Work</option>
															<option value="WORK"
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}">
																Work</option>
															<option value="OTHER"
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
																th:selected="${job.CustomerDTO.contactNumbers[0].contactNumberCategory.toString() == 'OTHER'}">
																Other</option>
															<option value="OTHER"
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}">
																Other</option>
														</select>
													</div>
													<input
														th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
														th:value="${job.CustomerDTO.contactNumbers[0].number}"
														id="estimate_mobileID" type="text" class="form-control "
														name="contactNumber" readonly>
													<input
														th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.contactNumbers) > 0}"
														id="estimate_mobileID" type="text" class="form-control "
														name="contactNumber" readonly>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="multi-email" class="form-label">Email</label>
									<div class="multi-field-wrapper" id="multi_email_wrapper_estimate">
										<div class="multi-fields" id="multi-fields_email">
											<div class="multi-field mb-2" id="multi-field_email">
												<div class="input_and_select">
													<div class="select">
														<select class="selectpicker form-control"
															id="multi-email-estimate" name="estimate_email_multi_select"
															disabled>
															<option
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																th:selected="${job.CustomerDTO.emails[0].emailCategory.toString() == 'PERSONAL'}"
																value="PERSONAL">
																Personal</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																selected="selected" value="PERSONAL">Personal
															</option>
															<option
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																th:selected="${job.CustomerDTO.emails[0].emailCategory.toString() == 'BUSINESS'}"
																value="BUSINESS">Business</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																selected="BUSINESS" value="PERSONAL">Business
															</option>
															<option
																th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																th:selected="${job.CustomerDTO.emails[0].emailCategory.toString() == 'OTHER'}"
																value="OTHER">Other</option>
															<option
																th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
																selected="OTHER" value="OTHER">Other</option>
														</select>
													</div>
													<input id="estimate_emailID" name="estimate_email_multi"
														th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
														th:value="${job.CustomerDTO.emails[0].email}" type="text"
														class="form-control" readonly>
													<input
														th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.emails) > 0}"
														id="estimate_emailID" type="text" class="form-control "
														name="contactNumber" readonly>
												</div>
											</div>
										</div>
									</div>
								</div>
								<p class="mt-5 section-heading">Service location</p>
								<div class="col-md-6 col-xl-3">
									<label for="location_name" class="form-label">Location
										nickname</label>
									<input type="text" class="form-control" id="location_name"
										name="estimate_email_multi"
										th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].locationNickName}"
										readonly>
									<input type="text" class="form-control" id="es_location_name"
										th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										readonly>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="apt_suite" class="form-label">Apt/suite/unit</label>
									<input type="text" class="form-control" id="es_apt_suite"
										th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].unit}" readonly>
									<input type="text" class="form-control" id="es_apt_suite"
										th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										readonly>
								</div>
								<div class="col-md-6">
									<label for="loca_address" class="form-label">Address</label>
									<input type="text" class="form-control" id="es_loca_address"
										th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].address}" readonly>
									<input type="text" class="form-control" id="es_loca_address"
										th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}">
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="locat_city" class="form-label">City</label>
									<input type="text" class="form-control" id="es_locat_city"
										th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].city}" readonly>
									<input type="text" class="form-control" id="es_locat_city"
										th:unless="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										readonly>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="locat_state" class="form-label">State/Zip</label>
									<input type="text" class="form-control" id="es_locat_state"
										th:if="${job.CustomerDTO != null and #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										th:value="${job.CustomerDTO.storedServiceLocations[0].state}" readonly>
									<input
										th:unless="${job.CustomerDTO != null and  #lists.size(job.CustomerDTO.storedServiceLocations) > 0}"
										type="text" class="form-control" id="es_locat_state" readonly>
								</div>
								<p class="mt-5 section-heading">Additional information</p>
								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Current
										Status</label>
									<select class="selectpicker form-control" id="select_tax_item" name="jobStatus">
										<option th:each="jobStatus : ${jobStatus}" th:value="${jobStatus}"
											th:text="${jobStatus}" th:selected="${jobStatus == job.jobStatus}"></option>
									</select>
								</div>
								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Assign
										Sales Person</label>
									<select class="selectpicker form-control" id="select_tax_item" name="salesPersonId">
										<option th:if="${job.CustomerDTO != null}"
											th:each="salesPerson : ${salesPersons}"
											th:value="${salesPerson.salesPersonId}"
											th:text="${salesPerson.salesPersonName}"
											th:selected="${job.customerDTO.salesPerson}"></option>
										<option th:unless="${job.CustomerDTO != null}"
											th:each="salesPerson : ${salesPersons}"
											th:value="${salesPerson.salesPersonId}"
											th:text="${salesPerson.salesPersonName}"></option>
									</select>
								</div>

								<div class="col-md-6 col-xl-3">
									<label for="select_tax_item" class="form-label">Responsibles</label>
									<select class="selectpicker form-control" multiple data-live-search="true"
										title="Select Responsibles" name="technicianId" disabled>
										<option th:each="technicianName : ${technicianNames}"
											th:text="${technicianName}" th:value="${technicianName}"
											th:selected="${technicianName}"></option>
									</select>
								</div>
								<div class="col-xl-4 col-md-6">
									<label for="inpdob" class="form-label">Job Start Date</label>
									<input type="date" class="form-control" id="jobStartDate" name="jobStartDate"
										th:value="${#strings.substring(job.createdAt, 0, 10)}" readonly>
								</div>
								<ul class="nav nav-tabs" id="myTab_custom" role="tablist">
									<li class="nav-item" role="presentation">
										<button class="nav-link active " id="tab_label1" data-bs-toggle="tab"
											data-bs-target="#tab1" type="button" role="tab" aria-controls="tab1"
											aria-selected="true">
											<div class="col-md-12 input-items">
												<img th:src="@{/assest/document-signed.svg}" class="img-icon me-2">
												<lable class="estimate-nav-item-label">Products/Services</lable>
											</div>
										</button>
									</li>
								</ul>
								<div th:if="${job.options != null}" class="tab-content" id="myTabContent_custom">
									<!--<p th:text="${job}"></p>-->
									<div th:each="option,itr : ${job.options}" class="tab-pane fade "
										th:classappend="${(itr.index)+1 == 1} ? ' show active'"
										th:id="${'tab'+(itr.index+1)}" role="tabpanel"
										th:aria-labelledby="${'tab_label'+(itr.index+1)}">
										<div class="estimate_report_container">
											<div class="container-fluid custome-data-table mt-5 p-0 overflow-auto"
												id="container">
												<table th:id="${'job-table'+(itr.index+1)}"
													th:name="${'job-table'+(itr.index+1)}"
													class="table custom-table custom-category-table dt-responsive nowrap w-100">
													<input type="hidden"
														th:name="${'estimate-table'+(itr.index+1)+'-input'}" value=1>
													<thead>
														<tr>
															<th></th>
															<th width="20%">Product/Service</th>
															<th width="40%">Description</th>
															<th>Quantity</th>
															<th>Rate</th>
															<th>Total</th>
															<!--<th>Cost</th>-->
														</tr>
													</thead>
													<tbody>
														<tr th:if="${option.optionProducts.size>0}"
															th:each="optionProduct,optionProductItr : ${option.optionProducts}"
															th:id="${'estimate-table'+(itr.index+1)+'tr'+(optionProductItr.index+1)}">
															<td th:text="${optionProductItr.index+1}"></td>
															<td>
																<div class="input-with-icon"
																	style="position: relative;">
																	<input th:if="${optionProduct.product!=null}"
																		readonly type="text"
																		placeholder="Type for search product.."
																		class="form-control"
																		th:name="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:id="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:value="${optionProduct.product.productName}"
																		onKeyUp="onSearchType(event)">
																	<input th:if="${optionProduct.services!=null}"
																		readonly type="text"
																		placeholder="Type for search product.."
																		class="form-control"
																		th:name="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:id="${'estimate-table'+(itr.index+1)+'ProductName'+(optionProductItr.index+1)}"
																		th:value="${optionProduct.services.serviceName}"
																		onKeyUp="onSearchType(event)">
																</div>
																<div th:id="${'estimate-table'+(itr.index+1)+'search_results'+(optionProductItr.index+1)}"
																	class="search-results"></div>
															</td>
															<td>
																<input type="text" class="form-control" placeholder=""
																	th:if="${optionProduct.product!=null}"
																	th:value="${optionProduct.product.discription}"
																	readonly>
																<input th:if="${optionProduct.services!=null}"
																	type="text" class="form-control" placeholder=""
																	th:value="${optionProduct.services.discription}"
																	readonly>
															</td>
															<td>
																<input type="number" class="form-control"
																	placeholder="0.00" readonly
																	th:id="${'estimate-table'+(itr.index+1)+'Quantity'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Quantity'+(optionProductItr.index+1)}"
																	th:value="${optionProduct.quantity}"
																	onchange="calculateTotal($('#'+this.id))">
															</td>
															<td><input th:if="${optionProduct.product!=null}"
																	type="text" class="form-control" placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.product.regularPrice, 0, 'COMMA', 2, 'POINT')}"
																	readonly>
																<input th:if="${optionProduct.services!=null}"
																	type="text" class="form-control" placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Rate'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.services.regularPrice, 0, 'COMMA', 2, 'POINT')}"
																	readonly>
															</td>
															<td><input type="text" class="form-control"
																	placeholder="0.00"
																	th:id="${'estimate-table'+(itr.index+1)+'Total'+(optionProductItr.index+1)}"
																	th:name="${'estimate-table'+(itr.index+1)+'Total'+(optionProductItr.index+1)}"
																	th:value="'$'+${#numbers.formatDecimal(optionProduct.total, 0, 'COMMA', 2, 'POINT')}"
																	readonly>
															</td>
														</tr>
														<ul id="search-results"></ul>
													</tbody>
												</table>

											</div>
											<div class="estimate_summary_container mt-5">
												<div class="row">
													<div class="col-lg-6 mb-3 mb-lg-0">
														<label for="inpexpiry" class="form-label">Notes to
															Customer</label>
														<textarea class="form-control custom-area" id="inpexpiry"
															rows="3"></textarea>
													</div>
													<div class="col-lg-6">
														<div class="estimate_summary">
															<div class="order-summary ">
																<h4 class="text-end fs-5">job Summary</h4>
																<hr>
																<div class="plan">
																	<p>job Total :</p>
																	<h5 th:if="${option.jobTotal != null}">
																		<span
																			th:text="'$'+${#numbers.formatDecimal(option.jobTotal, 0, 'COMMA', 2, 'POINT')}"></span>
																	</h5>
																	<h5 th:unless="${option.jobTotal != null}">
																		<span>$00.00</span>
																	</h5>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>
	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery.min.js}"></script>
	<script th:src="@{/js/bootstrap-select.min.js}"></script>
	<script th:src="@{/js/jquery.dataTables.min.js}"></script>
	<script th:src="@{/js/dataTables.responsive.min.js}"></script>
	<script th:src="@{/js/responsive.bootstrap5.min.js}"></script>
	<script th:src="@{/js/dataTables.bootstrap5.min.js}"></script>
	<script th:src="@{/js/slimselect.js}"></script>
	<script th:src="@{/js/customNewTab.js}"></script>
	<script th:src="@{/js/job.js}"></script>

	<!-- -----Leave page validation----- -->
	<script>
		$(document).ready(function () {

			disableSaveAndSendBtn();

			var originalURL = "";
			$('a').on('click', function (e) {
				if (!window.location.href.includes('/view/') && !event.target.id.includes('mainPageCancel')) {
					var elementType = this.tagName.toLowerCase();
					var isInsideMainDiv = $(this).closest('#add-job-parent-div').length > 0;

					if (elementType === "a" && !isInsideMainDiv) {
						originalURL = $(this).attr('href'); // Get the URL of the clicked link
					}

					if ($('#customer_name_input').val() || $('#estimate-table1ProductName1').val()) {
						// Open the modal and prevent the link or button from being followed
						$('#leaveModal').modal('show');
						e.preventDefault();
					}
				}
			});

			// When Leave button in the modal is clicked, redirect to the original link URL
			$('#leaveButton').on('click', function () {
				if (originalURL !== "") {
					window.location.href = originalURL;
				} else {
					// Handle the case when the Leave button is clicked without a previous link
					console.log("Redirect URL not available.");
				}
			});

			// When Cancel button in the modal is clicked, dismiss the modal
			$('#cancelButton').on('click', function () {
				$('#leaveModal').modal('hide');
			});

			// When the modal is hidden, reset the original URL
			$('#leaveModal').on('hide.bs.modal', function () {
				originalURL = "";
			});

			// Listen for browser back button click
			$(window).on('popstate', function () {
				// If the modal is currently open, close it
				if ($('#leaveModal').hasClass('show')) {
					$('#leaveModal').modal('hide');
				}
			});
		});

		//--------Add Customer Pop-up Validation---------//
		$("#customer_emailID").on("keyup", function (e) {
			var email = $('#customer_emailID').val();
			if ($('#customer_emailID').val() == null || $('#customer_emailID').val() == "") {
				$('#msg').show();
				$("#msg").html("email is a required field.").css("color", "red");
			} else {
				var regex =
					/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
				if (!regex.test(email)) {
					$('#msg').show();
					$("#msg").html("Invalid Email").css("color", "red");
					return;
				}
				$.ajax({
					type: 'GET',
					url: '/customer/searchByEmail/' + email,
					cache: false,
					success: function (msg) {
						$('#msg').show();
						$.each(msg, function (index, value) {
							console.log(value)
							console.log(index)
							if (value === 'Email already exists') {
								$("#msg").html(value).css("color", "red");
							} else {
								$("#msg").html(value).css("color", "green");
							}
						});


					},
					error: function (jqXHR, textStatus, errorThrown) {
						alert("fail");
						$('#msg').show();
						$("#msg").html(textStatus + " " + errorThrown).css("color", "red");
					}
				});
			}
		});

	</script>
	<script>
		var tables = document.getElementsByTagName('table');
		for (var i = 0; i < tables.length; i++) {
			resizableGrid(tables[i]);
		}

		function resizableGrid(table) {
			var row = table.getElementsByTagName('tr')[0],
				cols = row ? row.children : undefined;
			if (!cols) return;

			table.style.overflow = 'hidden';

			var tableHeight = table.offsetHeight;

			for (var i = 0; i < cols.length; i++) {
				var div = createDiv(tableHeight);
				cols[i].appendChild(div);
				cols[i].style.position = 'relative';
				setListeners(div);
			}

			function setListeners(div) {
				var pageX, curCol, nxtCol, curColWidth, nxtColWidth;

				div.addEventListener('mousedown', function (e) {
					curCol = e.target.parentElement;
					nxtCol = curCol.nextElementSibling;
					pageX = e.pageX;

					var padding = paddingDiff(curCol);

					curColWidth = curCol.offsetWidth - padding;
					if (nxtCol)
						nxtColWidth = nxtCol.offsetWidth - padding;
				});

				div.addEventListener('mouseover', function (e) {
					e.target.style.borderRight = '2px solid #0000ff';
				})

				div.addEventListener('mouseout', function (e) {
					e.target.style.borderRight = '';
				})

				document.addEventListener('mousemove', function (e) {
					if (curCol) {
						var diffX = e.pageX - pageX;

						if (nxtCol)
							nxtCol.style.width = (nxtColWidth - (diffX)) + 'px';

						curCol.style.width = (curColWidth + diffX) + 'px';
					}
				});

				document.addEventListener('mouseup', function (e) {
					curCol = undefined;
					nxtCol = undefined;
					pageX = undefined;
					nxtColWidth = undefined;
					curColWidth = undefined;
				});
			}

			function createDiv(height) {
				var div = document.createElement('div');
				div.style.top = 0;
				div.style.right = 0;
				div.style.width = '5px';
				div.style.position = 'absolute';
				div.style.cursor = 'col-resize';
				div.style.userSelect = 'none';
				div.style.height = height + 'px';
				return div;
			}

			function paddingDiff(col) {

				if (getStyleVal(col, 'box-sizing') == 'border-box') {
					return 0;
				}

				var padLeft = getStyleVal(col, 'padding-left');
				var padRight = getStyleVal(col, 'padding-right');
				return (parseInt(padLeft) + parseInt(padRight));

			}

			function getStyleVal(elm, css) {
				return (window.getComputedStyle(elm, null).getPropertyValue(css))
			}
		};
	</script>


</body>

</html>